import{B as ae}from"./a6d0ee077b9cc3485bbd70404dec4c25.js";import{d as Y,o as le}from"./a917ecdde6f9bd006481134216d18309.js";import{C as M}from"./989aa6bb6448c33c925f59d410861c78.js";import{d as se}from"./2f0ba330a9fe20d9e75da86d9009bc02.js";import{M as re}from"./627790d07d05a1e3f1edac3d8d9e5374.js";import{m as oe}from"./5900820d402351b6ced9644caf1aeb74.js";import{H as X}from"./3b977fb3d05d7c837f2c2a36b962aba8.js";import{m as fe}from"./215b80e923e12745f9ed657e17d445e9.js";import"./fa33a1d8cfa1706fa45935e4b38d2e4a.js";import{l as ue}from"./5e85fbd0320a36c22ba51601e1fd6d3e.js";const f={Local:{},Sync:{},LocalOld:{},SyncOld:{},LocalQuote:0,LocalUsageQuote:0,LocalKeyByUsage:{},constructor(){},async build(o="local",e=0){return await new Promise(async(t,i)=>await l.Browser().storage[o].get(null).then(async n=>{let a=l.firstUpperCase(o),s=f[a];return Object.keys(n).forEach(r=>{typeof s[r]<"u"&&delete s[r]}),Object.keys(s).length>0&&(await l.Browser().storage[o].set(s),n=Object.assign(s,n)),f[a]=l.JsonParse(n),f.LocalUsageQuote==0&&await f.quoteCheck(),e==1?t(f[o]):t(f)}).catch(async n=>{if(console.log(n),n.indexOf("QUOTA_BYTES")!==-1)return await f.cleanUpStorage(!0);console.log(n)}))},async listener(o){return typeof l.Browser().storage.migration_status>"u"&&(l.Browser().storage.migration_status=!1),l.Browser().storage.onChanged.addListener((e,t)=>{let i=Object.keys(e);if(i.indexOf("migration_status")!==-1){let n=i[i.indexOf("migration_status")];l.Browser().storage.migration_status=e[n].newValue??!1}return Object.keys(e).forEach(n=>{let a=n,s=e[n].oldValue,r=e[n].newValue;if(typeof f[t]>"u"&&(f[t]={}),typeof f[`${t}Old`]>"u"&&(f[`${t}Old`]={}),typeof r<"u"&&r!=null?typeof r[a]<"u"?this[t][a]=f[t][a]=r[a]:this[t][a]=f[t][a]=r:this[t][a]=f[t][a]=null,typeof s<"u"&&s!=null?typeof s[a]<"u"?this[`${t}Old`][a]=f[`${t}Old`][a]=s[a]:this[`${t}Old`][a]=f[`${t}Old`][a]=s:this[`${t}Old`][a]=f[`${t}Old`][a]=null,a.indexOf("ai_single_")!==-1){let u=a.replace("ai_single_","");this[t].ai_single==null&&(this[t].ai_single=f[t].ai_single={}),this[t].ai_single&&typeof this[t].ai_single[u]>"u"&&(this[t].ai_single[u]=f[t].ai_single[u]={}),typeof r[a]<"u"?this[t].ai_single[u]=f[t].ai_single[u]=r[a]:this[t].ai_single[u]=f[t].ai_single[u]=r,console.log(f[t].ai_single[u],r[a],r)}}),o.storage=f,Object.keys(e).forEach(n=>{n=="settings"&&f[t][n]==null&&console.error(n,f[t][n]),f[t][n]!=f[`${t}Old`][n]&&o.changeListener(t,n,f[t][n],f[`${t}Old`][n],l.Browser().storage.migration_status??!1)}),f})},async quoteCheck(){if(typeof l.Browser().storage.local.QUOTA_BYTES<"u"){f.LocalQuote=l.Browser().storage.local.QUOTA_BYTES;let o=0,e=await l.Browser().storage.local.get();e&&(Object.keys(e).forEach(t=>{let i={};i[t]=e[t];let n=new Blob([JSON.stringify(i)]).size;o+=n,this.LocalKeyByUsage[t]=n}),f.LocalUsageQuote=o,await f.cleanUpStorage())}},async cleanUpStorage(o=!1){let e=f.LocalQuote,t=f.LocalUsageQuote,i=2e5,n=!1,a=null,s=5e4,r=19;if(e-=i,e<=t||o==!0){console.log(e,t,o,e<=t||o==!0);let u=await l.Browser().storage.local.get("ai_chat");if(typeof u.ai_chat<"u"){let c=u.ai_chat;if(c!==null){let p=Object.keys(c);p.length>11?p.forEach(g=>{Number.parseInt(g)>0&&Object.keys(u.ai_chat).length>r&&(delete u.ai_chat[g],u.ai_chat=Object.values(u.ai_chat),n=!0,a="ai_chat")}):p.forEach(g=>{c[g]&&typeof c[g].item<"u"&&(c[g].item.length>s?(u.ai_chat[g].item=c[g].item=c[g].item.toString().substring(0,s),n=!0,a="ai_chat"):typeof c[g].prompt<"u"&&c[g].prompt.length>s&&(u.ai_chat[g].prompt=c[g].prompt=c[g].prompt.toString().substring(0,s),n=!0,a="ai_chat"))})}}if(n&&a!=null)return await l.Browser().storage.local.set(u).catch(async c=>{c.indexOf("QUOTA_BYTES")!==-1&&(await l.Browser().storage.local.remove(a),await l.Browser().storage.local.set(u))}),f.quoteCheck()}}},O={db_name:"AiTopia",open_db:null,db_version:1,open:async(o=null)=>{if(o!=null&&(O.db_name=o),location&&location.search&&location.search.indexOf("clear")!==-1&&O.open_db==null){await Y(O.db_name),await indexedDB.deleteDatabase(O.db_name);let e=new URLSearchParams(location.search);e.delete("clear"),Object.keys(e).length>0?window.location.href=window.location.origin+"?"+e.toString()+location.hash:window.location.href=window.location.origin}return O.open_db=await le(O.db_name,O.db_version,{upgrade(e,t,i,n,a){e.createObjectStore(O.db_name,{keyPath:"key",autoIncrement:!1})},blocked(e,t,i){console.log("BLOCKED")},blocking(e,t,i){console.log("BLOCKING")},terminated(){console.log("TERMINATE")}})},storage:{get:async(o=null)=>{let e={};return typeof o=="string"&&o!=null&&(o=[o]),(o==null||typeof o!="object")&&(o=[]),new Promise(async(t,i)=>{let n=await O.open();try{let u=await n.transaction(O.db_name,"readonly").objectStore(O.db_name)}catch(u){console.log(u);return}let a=await n.transaction(O.db_name,"readonly").objectStore(O.db_name),s=!1,r=[];if(o&&o.length>0){for(let u of o){let c=null;l.notUndefined(f.Local,u)?c={key:u,value:l.notUndefined(f.Local,u)}:(u=l.AesEnCrypt(u),c=await a.get(u),l.notUndefined(c,"key")&&(c.key=l.AesDeCrypt(c.key)??c.key),l.notUndefined(c,"value")&&(c.value=l.JsonParse(l.AesDeCrypt(c.value)??c.value))),r.push(c)}s=!0}s||(r=await a.getAll()),r&&r.forEach(u=>{if(l.notUndefined(u,"value")){let c=l.notUndefined(u,"key"),p=l.notUndefined(u,"value");s||(c=l.AesDeCrypt(c)??null,p=l.JsonParse(l.AesDeCrypt(p)??null)??null),e[c]=f.Local[c]=p}}),t(e)})},set:async(o={})=>await new Promise(async(e,t)=>{let n=await(await O.open()).transaction(O.db_name,"readwrite").objectStore(O.db_name),a={};if(o&&Object.keys(o).length>0){let s=!1;for(const r of Object.keys(o)){let u=!1;o[r]=l.JsonParse(o[r]);let c={key:l.AesEnCrypt(r),value:l.AesEnCrypt(JSON.stringify(o[r]))??null,updated_date:new Date().getTime()},p=await n.getKey(l.AesEnCrypt(r)),g=await n.get(l.AesEnCrypt(r));l.notUndefined(g,"key")&&(g.key=l.AesDeCrypt(g.key)??g.key),l.notUndefined(g,"value")&&(g.value=l.JsonParse(l.AesDeCrypt(g.value)??g.value)),typeof p>"u"?(await n.add(c),s=u=!0,a[r]={oldValue:null,newValue:o[r]}):l.notUndefined(g,"value")!=JSON.stringify(o[r])&&(a[r]={oldValue:null,newValue:o[r]},a[r].oldValue=l.JsonParse(l.notUndefined(g,"value")??null)??null,await n.put(c),s=u=!0),u&&(f.Local[r]=o[r])}s&&window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:a}))}e(!0)}),remove:async o=>new Promise(async(e,t)=>{if(o){let n=await(await O.open()).transaction(O.db_name,"readwrite").objectStore(O.db_name);if(o.length>0&&typeof o=="object"){for(const a of o)if(typeof f.Local[a]<"u"||typeof f.Local[a]<"u"){let s={};s[a]={oldValue:f.Local[a]??f.Local[a]??null,newValue:null},await n.delete(l.AesEnCrypt(a)),typeof f.Local[a]<"u"&&delete f.Local[a],typeof f.Local[a]<"u"&&delete f.Local[a],window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:s}))}}}e(!0)}),clear:async()=>new Promise(async(o,e)=>{await Y(O.db_name),window.location.reload(),o(!0)})},customAddListener:(o,e,t)=>window.addEventListener(o,i=>typeof e=="function"?e(i.detail,t):{detail:i.detail,namespace:t})};typeof window<"u"&&(window.umut_storage=O.storage);const ce={storage:{local:O.storage,onChanged:{addListener:(o,e)=>O.customAddListener("localStorageOnChange",o,"Local")}},runtime:{id:null}};let J=ae;typeof chrome<"u"&&(J=chrome??J);let ne="aitopia.ai";const G=[ne,"chatgptextension.ai"];let R=location.hostname.split(".");R.length>2&&(delete R[0],R=Object.values(R));R=R.join(".");var ie;const F=((ie=J==null?void 0:J.runtime)==null?void 0:ie.id)??null;var S=F?`chrome-extension://${F}`:"";S!==""&&(S+="/aitopia");S+="/";var B=G[G.indexOf(R)]??G[0];const W="chat.";let de=!1,$=B;B&&(B.split(".").length>2&&(B=B.split("."),delete B[0],B=Object.values(B).join(".").toString()),$=B,B.indexOf("chatgptextension")===-1&&B.indexOf("extension://")===-1&&($=W+$));const ee="extensions",k="src/html",d={domain:B,domain_allows:G,runtime_id:F??null,build_type:"partner",main_dir:k,site:`https://${$}`,site_buy_plan:`https://${$}/subscription`,site_payment:`https://${$}/payment`,site_pricing:`https://${$}/pricing`,terms_conditions:`https://${$}/terms-conditions`,privacy_policy:`https://${$}/privacy-policy`,login:`https://${$}/auth`,login_prefix:`https://${$}/auth?logout`,profile:`https://${$}/app/profile`,api_mode:ee,api_url:`https://${ee}.${B}`,download_url:`https://download.${B}`,cdn_url:`https://cdn.${B}`,web_app_prefix:W,web_app:`https://${W}${ne}`,extension_pricing:`${S}${k}/pricing.html`,extension_payment_success:`${S}${k}/payment_success.html`,extension_google_page:"https://chromewebstore.google.com/detail/chatgpt-sidebar-gpt-4-vis/becfinhbfclcgokjlobojlnldbfillpf",extension_id:F,manuel_extension_id:"becfinhbfclcgokjlobojlnldbfillpf",extension_dir:`${S}`,extension_main_dir:`${S}${k}`,lang_cache_type:"Local",debugMode:0,version:"5.8.0",app_name:"AITOPIA",app_title:"ChatGPT Sidebar & GPT-4o, o1, Claude, Deepseek with AI Agents | AITOPIA",app_description:"ChatGPT Sidebar with GPT-4o, o1, Claude, Deepseek models will boost your workflow with the power of AI Agent Marketplace",app_search_title:"ChatGPT Sidebar",app_logo:"/aitopia/aitopia.svg",app_logo_full:null,app_install:!0,app_uninstall:!0,app_context:!0,app_main_color:null,app_main_color_dark:null,app_main_link_color:null,app_main_link_color_dark:null,app_store_url:null,build_finish:!1,mode:"production",debug_time:"",web_access_search_limit:5,ai_default_model:"GPT-4o Mini",image_upscaling_id:"image-upscaling",console_data:[],hello_world_test:"function helloWorld(args){if (!args)return false;}function testing(args){if (args)return true;}",disallow_pages:["accounts.google.com"],is_web_app:de,search_pages:{"www.google.com/search":{selector:'body textarea[type="search"],body textarea[aria-label="search"],body textarea[name="q"]',container:"#rhs",empty_selector:"#rcnt",empty_selector_position:"#center_col",empty_element:'<div class="TQc1id rhstc4" jscontroller="cSX9Xe" data-pws="1300" data-spe="true" jsaction="rcuQ6b:npT2md" id="rhs" jsdata="MdeVKb;_;A38Ny0" role="complementary" data-hveid="CAEQAA"></div>'},"www.yandex.com/search":{selector:'body [role="search"] [name="text"]',container:"#search-result-aside",empty_selector:".main__content > div",empty_selector_position:"",empty_element:'<div class="content__right content__right_cols_12" id="search-result-aside" data-log-node="2_apy0w00g" tabindex="-1"><div class="serp-list serp-list_right_yes"></div></div>'},"www.bing.com/search":{selector:'body [role="search"] [type="search"],body [role="search"] .b_searchbox',container:"#b_context",empty_selector:"#b_content > aside:first-child",empty_selector_position:"",empty_element:'<ol id="b_context"></ol>'},"www.duckduckgo.com":{selector:'body #search_form_input, body #search_form > input[type="text"]',container:'#web_content_wrapper [data-testid="sidebar"]',empty_selector:"",empty_selector_position:"",empty_element:'<section data-testid="sidebar" data-area="sidebar"></section>'},"search.yahoo.com/search":{selector:'body [role="search"] input[type="text"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.baidu.com/s":{selector:'#form [name="wd"],#form #kw',container:"#container #content_right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.ask.com/web":{selector:'[name="searchBoxContainer"] [name="q"]',container:"main .l-right-container",empty_selector:"",empty_selector_position:"",empty_element:""},"search.aol.com":{selector:'[role="search"] [name="q"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""}},ai_reply:{"mail.google.com":{reply_button:".ams.bkH",button:".amn",container:'[role="listitem"]:last-child',alternative_container:'[role="listitem"]:last-child',edit_container:'[role="listitem"] .editable',reply_insert_container:".Am.Al.editable.LW-avf",dot_position:{bottom:"25%",left:"85%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".gD[email]",mode:"attribute",type:"email"},{name:"sender_name",selector:".gD[name]",mode:"attribute",type:"name"},{name:"receiver_email",selector:".g2[email]",mode:"attribute",type:"email"},{name:"receiver_name",selector:".g2[name]",mode:"attribute",type:"name"},{name:"email_content",selector:".a3s > *",mode:"simple",type:"innerText"}]},"outlook.live.com":{reply_button:".th6py button:first-child",button:".Jj1JU,.th6py",container:'[role="document"][aria-expanded="true"]',alternative_container:'[role="document"][aria-expanded]',edit_container:'[id*="editorParent_"] [role="textbox"][contenteditable="true"]',reply_insert_container:`[id*='editorParent_'] [contenteditable="true"] > *:first-child`,dot_position:{bottom:"50%",left:"80%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"sender_name",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"receiver_email",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"receiver_name",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"email_content",selector:'[role="document"][aria-expanded="true"] [id*="UniqueMessageBody_"] div',mode:"simple",type:"innerText"}]},"mail.yandex.com":{reply_button:".qa-QuickReplyPlaceholder",button:".ns-view-toolbar-buttons .ns-view-container-desc",container:".mail-Layout-Content",alternative_container:".qa-MessageViewer article:last-child",edit_container:'[role="presentation"] [role="textbox"]',reply_insert_container:'[role="presentation"] [role="textbox"] div',dot_position:{bottom:"25%",left:"75%"},detail_elements:[{name:"history",selector:".qa-MessageViewer article",mode:"simple",type:"textContent"},{name:"sender_email",selector:".qa-MessageViewer-SenderEmail",mode:"attribute",type:"title"},{name:"sender_name",selector:".qa-MessageViewer-SenderName",mode:"attribute",type:"title"},{name:"receiver_email",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"receiver_name",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"email_content",selector:".qa-MessageViewer article",mode:"simple",type:"innerText"}]}},ai_reply_data:{},click_open_url:{"aifnmjmchg-pricing":"extension_pricing","aifnmjmchg-login":"login","aifnmjmchg-login-prefix":"login_prefix","aifnmjmchg-subscription":"site_buy_plan","aifnmjmchg-profile":"profile","aifnmjmchg-g-extension":"extension_google_page","aifnmjmchg-options":`${S}${k}/options.html`,"aifnmjmchg-options-search":`${S}${k}/options.html?mode=search`,"aifnmjmchg-contact":`${S}${k}/options.html?mode=contact`,"aifnmjmchg-options-yt":`${S}${k}/options.html?mode=youtube`,"aifnmjmchg-terms":"terms_conditions","aifnmjmchg-privacy":"privacy_policy"},aspect_rations:[{value:"21 : 9",tooltipText:"1536 x 640",width:"1536",height:"640"},{value:"16 : 9",tooltipText:"1344 x 768",width:"1344",height:"768"},{value:"3 : 2",tooltipText:"1216 x 832",width:"1216",height:"832"},{value:"5 : 4",tooltipText:"1152 x 896",width:"1152",height:"896"},{value:"1 : 1",tooltipText:"1024 x 1024",width:"1024",height:"1024"},{value:"4 : 5",tooltipText:"896 x 1152",width:"896",height:"1152"},{value:"2 : 3",tooltipText:"832 x 1216",width:"832",height:"1216"},{value:"9 : 16",tooltipText:"768 x 1344",width:"768",height:"1344"},{value:"9 : 21",tooltipText:"640 x 1536",width:"640",height:"1536"}],styles:[{name:"None",style:"none",icon:`${S}//assets/images/image_chat/default.png`},{name:"Anime",style:"anime",icon:`${S}//assets/images/image_chat/anime.png`},{name:"Photographic",style:"photographic",icon:`${S}//assets/images/image_chat/photographic.png`},{name:"Digital Art",style:"digital-art",icon:`${S}//assets/images/image_chat/digital_art.png`},{name:"Comic Book",style:"comic-book",icon:`${S}//assets/images/image_chat/comic_book.png`},{name:"Fantasy Art",style:"fantasy-art",icon:`${S}//assets/images/image_chat/fantasy_art.png`},{name:"Line Art",style:"line-art",icon:`${S}//assets/images/image_chat/line_art.png`},{name:"Analog Film",style:"analog-film",icon:`${S}//assets/images/image_chat/analog_film.png`},{name:"Neon Punk",style:"neon-punk",icon:`${S}//assets/images/image_chat/neon_punk.png`},{name:"Isometric",style:"ısometric",icon:`${S}//assets/images/image_chat/isometric.png`},{name:"Low Poly",style:"low-poly",icon:`${S}//assets/images/image_chat/low_poly.png`},{name:"Origami",style:"origami",icon:`${S}//assets/images/image_chat/origami.png`},{name:"Cinematic",style:"cinematic",icon:`${S}//assets/images/image_chat/cinematic.png`},{name:"3D Model",style:"3d-model",icon:`${S}//assets/images/image_chat/three_d_model.png`},{name:"Pixel Art",style:"pixel-art",icon:`${S}//assets/images/image_chat/pixel_art.png`}],tools:[{id:1,name:"Remove Background",description:"Extract the main subject from a image with incredible accuracy.",video:`${S}/assets/videos/remove-background-demo.mp4`,actionCode:"remove-background"},{id:2,name:"Remove Text",description:"Remove text from any image.",video:`${S}/assets/videos/remove-text-demo.mp4`,actionCode:"remove-text"},{id:3,name:"Upscale",description:"Upscale your image by 2× or 4× with in seconds.",video:`${S}/assets/videos/Enhance.webm`,actionCode:"image-upscaling"},{id:4,name:"Replace Background",description:"Teleport anything, any where with AI.",video:`${S}/assets/videos/ReplaceBackground.webm`,actionCode:"replace-background"}],editTools:[{credit:1,id:"image-upscaling",image:!0,mask:!1,name:"Image Upscaling",prompt:!1,size:!0,explanation:"Select image magnification:",sectionWidth:90},{credit:1,id:"reimagine",image:!0,mask:!1,name:"Variation",prompt:!1,size:!1,explanation:null,sectionWidth:null},{credit:4,id:"remove-background",image:!0,mask:!1,name:"Remove Background",prompt:!1,size:!1,explanation:"Remove background from this image",sectionWidth:65},{credit:4,id:"remove-text",image:!0,mask:!1,name:"Remove Text",prompt:!1,size:!1,explanation:"Remove all text from the image",sectionWidth:60},{credit:6,id:"replace-background",image:!0,mask:!1,name:"Replace Background",prompt:!0,size:!1,explanation:null,sectionWidth:90}],pinnedContextPrompts:{reading:[42,43],writing:[45,56]},contextBlacklist:{"www.google.com":{selectors:["textarea[role='combobox']"]}},ExtensionBrowser:J??chrome??{},Browser:F?J??chrome??{}:ce,api_call_try:0,api_call_max_try:4,reply_prompts:{getEmailIntent:64,getEmailKeyPoints:65,getRelatedSuggestions:66,askAiReply:63},default_prompt_settings:{format:{model:"model_settings.format.items",label_before:"model_settings.format.html",label:"model_settings.format.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.format",default:"essay",type:"radio"},tone:{model:"model_settings.tone.items",label_before:"model_settings.tone.html",label:"model_settings.tone.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.tone",default:"formal",type:"radio"},length:{model:"model_settings.length.items",label_before:"model_settings.length.html",label:"model_settings.length.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.length",default:"short",type:"radio"},lang:{model:"storage.Local.languages",no_translate:!0,model_element:"title",model_prefix:"name",model_default:"settings.language_detail.name",type:"select",label:"Language"}},pageReadOptions:[{id:"summarize",label:"Summarize",prompt:"Please provide a concise summary of the following content:",description:"Get a brief overview of the main points and key takeaways",requireNavigateTo:"chat"},{id:"concepts",label:"Clarify key concepts",prompt:"Please identify and explain the key concepts from the following content:",description:"Break down complex ideas and terminology into simpler explanations",requireNavigateTo:"chat"},{id:"assumptions",label:"Identify Assumptions",prompt:"Please identify and explain the underlying assumptions in the following content:",description:"Uncover implicit beliefs and premises that shape the content",requireNavigateTo:"chat"},{id:"author",label:"Learn about author",prompt:"Please analyze and explain what we can learn about the author from the following content:",description:"Analyze writing style, perspective, and potential background of the author",requireNavigateTo:"chat"},{id:"keypoints",label:"Key Points",prompt:"Please identify and explain the key points from the following content:",description:"Extract and explain the most important arguments and evidence",requireNavigateTo:"chat"},{id:"related_news",label:"Find related news",prompt:"Please suggest and find relevant news articles from web related to the main topics in this content:",description:"Discover current news articles and updates on similar topics",requireNavigateTo:"web_search",search_prefix:"related news"},{id:"related_videos",label:"Watch related videos",prompt:"Please suggest relevant videos and documentaries that would complement or expand upon the topics in this content only prefer youtube videos:",description:"Find educational videos and documentaries to deepen understanding",requireNavigateTo:"web_search",search_prefix:"related youtube videos"}]},b={switchbar:"chat",color_mode:"auto",ai_mode:"local",ai_key:null,language:ge(),language_name:null,language_detail:{},send_cmd:"enter",sidebar_cmd:"ctrl+y",color_mode_cmd:"ctrl+shift+l",fullscreen_cmd:"ctrl+shift+f",sidebar_show_icon:!0,sidebar_position:"right",sidebar_space:"overlay",search:!0,search_ask_mode:"manuel",youtube:!0,youtube_summarize_mode:"always",ai_model:d.ai_default_model,web_access:!1,context_reading:!0,context_reading_show_cmd:"ctrl",context_menu_shortcut_cmd:"ctrl+j",context_writing:!0,context_writing_input:!0,email_assistant:!0};function ge(){let o=navigator.language||(navigator.userLanguage??"en");return o.indexOf("-")!=-1&&(o=o.split("-")[0]),o.indexOf("_")!=-1&&(o=o.split("_")[0]),o}class pe{marked;count;constructor(){this.marked=new re(oe({langPrefix:"hljs language-",highlight(e,t,i){const n=X.getLanguage(t)?t:"plaintext";return X.highlight(e,{language:n}).value}})),this.marked.Renderer.prototype.paragraph=e=>typeof e=="string"?e+`
`:e.text+`
`,this.marked.Renderer.prototype.link=({href:e,title:t,text:i})=>{let n="";typeof t<"u"&&(n='title="'+t+'" ');let a="";typeof e<"u"&&(a='href="'+e+'" ');let s="";return e.indexOf("://")!==-1&&(s='target="_blank" '),"<a "+s+a+" "+n+">"+i+"</a>"}}pretty(e){if(e===null||typeof e>"u"||typeof e=="object"||e.indexOf("hljs language")!==-1)return e;let t;function i(n){let a=n.match(/\*\*(.*?)\*\*/g);return a&&a.forEach(s=>{let r=s.replace(/\*\*/g,"");r="<strong>"+r+"</strong>",n=n.replace(new RegExp(l.RegexSpecialFixer(s),"g"),r)}),n}return i(this.marked.parse(e.replace(/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/,""),t).toString())}}const he=new pe,K=fe(),V={emit:(o,e)=>K.emit(o,e),on:(o,e)=>K.on(o,e),off:(o,e)=>K.off(o,e)},te={QUESTION:{START:`<a href='javascript:;' class="aifnmjmchg-action-question">`,END:"</a>"},SUGGESTION:{START:`<a href='javascript:;' class="aifnmjmchg-action-suggestion">`,END:"<span>→</span></a>"}};console.time();const Q={chats:{},ai_all_response:{},ai_response:[],instance:null,aborting:{},long_prefix:"<#Finished#>",count:0,extra_key:null,expires:{},ai_wait:!1,prompt_prefix:"##",last_stream:"",is_group_chat:!1,uuid_extra_data:{},debounceTimeout:null,pendingUpdates:new Map,debounce(o,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>o.apply(this,i),e)}},async processPendingUpdates(o,e){if(!this.pendingUpdates.has(`${o}-${e}`))return;const t=this.pendingUpdates.get(`${o}-${e}`);this.pendingUpdates.delete(`${o}-${e}`),!(!t||!t.length)&&(await this.setDataStorage(e,o),l.scrollToBottom())},queueUpdate(o,e,t,i){const n=`${o}-${e}`;this.pendingUpdates.has(n)||this.pendingUpdates.set(n,[]);const a=this.pendingUpdates.get(n);a&&(a.push({content_index:t,content:i}),this.debounce(()=>this.processPendingUpdates(o,e),150)())},async chat(o="",e=null,t="ai_chat",i="__all",n=!1,a=!1,s=null,r=!1,u={},c=!1,p=0){var D,Z;if(this.ai_wait)return;typeof this.aborting[i]<"u"&&(this.aborting[i]=null);let g=await l.Browser().storage.local.get(["settings","credit_detail","expires","ai_image_url","ai_chat_ids","context_data",t]);if(l.notUndefined(g,"context_data")&&!(u!=null&&u.mode)){const v=window.location.pathname,L=(D=g.context_data)==null?void 0:D.mode,N={chatwithfile:"chat_with_file.html"};L&&N[L]&&v.endsWith(N[L])&&((Z=g.context_data)!=null&&Z.contextData&&(o=`##HIDDEN_CONTEXT_START##${g.context_data.contextData.context}##HIDDEN_CONTEXT_END##`+o),t="ai_single",i=l.SHA1("chat_with_file"),n=!1,a=!1)}this.key_detail=await l.Browser().storage.local.get(["uuid_hopekey","uuid_search"]),this.settings=l.notUndefined(g,"settings"),e==null&&(e=d.ai_default_model);let _=this.settings.ai_image_model==e?"image":"text";e===null&&(e=this.settings.ai_model),this.waiting(!0),this.credit_detail=l.notUndefined(g,"credit_detail"),typeof this.ai_all_response[i]>"u"&&(this.ai_all_response[i]={}),typeof this.ai_all_response[i][t]>"u"&&(this.ai_all_response[i][t]=[]);let h=l.notUndefined(g,`${t}`);typeof g.expires!=null&&(this.expires=g.expires);let m={};typeof h=="string"?(m=JSON.parse(h),Object.keys(m).length>0&&Object.keys(m).forEach(v=>{typeof this.ai_all_response[v]>"u"&&(this.ai_all_response[v]={}),this.ai_all_response[v][t]=Object.values(m[v])})):(m=h,m!=null&&(t=="ai_chat"?this.ai_all_response[i][t]=Object.values(m):typeof m[i]<"u"&&(this.ai_all_response[i][t]=Object.values(m[i])))),t=="ai_single"&&n==!0&&r==!1&&typeof this.ai_all_response[i]<"u"&&typeof this.ai_all_response[i][t]<"u"&&(this.ai_all_response[i][t]=[],Object.keys(this.ai_all_response[i][t]).length>0),this.uuid_search=l.notUndefined(this.key_detail,"uuid_search"),this.hopekey=l.notUndefined(this.key_detail,"uuid_hopekey"),document.querySelector("#aifnmjmchg-container");let y=`${d.api_url}/ai/send`;if(this.credit_detail!=null){let v=e;if(this.settings.web_access&&(v="GPT-4o"),typeof this.credit_detail[v]<"u"&&this.credit_detail[v].balance<this.credit_detail[v].cost&&this.credit_detail[v].credit!=-999&&this.settings.ai_mode!=="api"){this.ai_all_response[i][t].forEach((L,N)=>{L.role=="limit"&&delete this.ai_all_response[i][t][N]}),this.ai_all_response[i][t]=Object.values(this.ai_all_response[i][t]),this.ai_all_response[i][t].push({item:"Usage Limit please upgrade plan.",role:"limit",model:e}),await this.setDataStorage(t,i),await this.waiting(!1);return}}let T=this.ai_all_response[i][t],x=0,q=!1;Object.keys(this.ai_all_response[i][t]).length>0&&!l.notUndefined(u,"search")&&this.ai_all_response[i][t].forEach((v,L)=>{x++,T!=x&&this.ai_all_response[i][t][L].loading==!0&&(this.ai_all_response[i][t][L].loading=!1,q=!0),v.role=="limit"&&(delete this.ai_all_response[i][t][L],this.ai_all_response[i][t]=Object.values(this.ai_all_response[i][t]),q=!0)}),c&&(this.is_group_chat=!0,q=!0),q&&await this.setDataStorage(t,i);let I="";this.count++;let w="user";_=="image"&&(w="image"),(u==null||typeof u!="object")&&(u={}),(String(o).trim().length>0||w=="image")&&r==!1&&(u.prompt_mode=a,p==0&&this.ai_all_response[i][t].push({item:o,role:w,model:e,title:s,loading:w=="image",extra_data:u})),_!="image"&&l.notUndefined(g,"ai_image_url")!=null&&l.notUndefined(g,"ai_image_url")!==""&&typeof u.search_mode>"u"&&(e="GPT-4o Vision",this.settings.web_access=!1,u.ai_image_url=l.notUndefined(g,"ai_image_url"),await l.Browser().storage.local.set({ai_image_url:null}),await l.Browser().storage.local.remove(["ai_image_url"]));let E=l.ChatId(t,i),A={history:this.ai_all_response[i][t],text:o,model:e,stream:_!="image",uuid_search:this.uuid_search,mode:t,prompt_mode:a,extra_key:i,extra_data:u,chat_id:E,language_detail:this.settings.language_detail,is_continue:r};this.uuid_extra_data={chat_id:A.chat_id,history:A.history,mode:t},this.settings.ai_key&&this.settings.ai_mode=="api"&&(A.token=this.settings.ai_key),this.settings.language&&(A.lang_code=this.settings.language);let j=this.ai_all_response[i][t].length;(_=="image"||l.notUndefined(u,"search"))&&(j=j-1),j<0&&(j=0);let P="";r==!0&&this.ai_all_response[i][t].forEach((v,L)=>{typeof v.finish_reason<"u"&&v.finish_reason=="length"&&(v.finish_reason="",j=L,I=P=v.item)}),this.ai_all_response[i][t].forEach((v,L)=>{typeof v.finish_reason<"u"&&v.finish_reason=="length"&&(v.finish_reason="stop")}),_!="image"&&(this.ai_all_response[i][t][j]={item:P,role:"system",model:e,loading:!0,title:s,extra_data:u}),await this.setDataStorage(t,i),this.aborting[i]=new AbortController;let C=document.querySelectorAll("#aifnmjmchg-stop-chat-"+t),U=document.querySelectorAll("#aifnmjmchg-stop-chat-"+t+" button");U!=null&&C!=null&&(C.forEach(v=>{v.classList.remove("aifnmjmchg-hide"),v.classList.add("aifnmjmchg-show")}),this.aborting[i].signal.addEventListener("abort",()=>{t=="ai_single"?Object.values(this.ai_all_response[i][t]).length>0&&this.ai_all_response[i][t].forEach((v,L)=>{this.ai_all_response[i][t][L].loading=!1,this.ai_all_response[i][t][L].stop=!0}):(this.ai_all_response[i][t][j].loading=!1,this.ai_all_response[i][t][j].stop=!0),this.setDataStorage(t,i),this.waiting(!1)}),Object.keys(U).length>0&&U.forEach(v=>{v.onclick=L=>{this.aborting[i].abort(),this.waiting(!1);let N={force:1};this.is_group_chat&&(N.extra_data=this.uuid_extra_data),l.sendMessage("uuid",N),C.forEach(z=>{z.classList.add("aifnmjmchg-hide"),z.classList.remove("aifnmjmchg-show")})}}));let H=null;return await this.setDataStorage(t,i),["image"].indexOf(_)!==-1?await this.imageApi(t,e,i,A,j,C,H,y,I).finally(async()=>await this.waiting(!1)):l.notUndefined(this.settings,"web_access")==!0&&["image"].indexOf(e)===-1&&r==!1&&i=="__all"&&!l.notUndefined(u,"search")&&o.length<=2048&&a==!1?(l.Browser().web_access_mode=t,l.Browser().web_access_extra_key=i,l.sendMessage("GoogleSearchCall",o,"GoogleSearchCallback","tabs")):await this.aiApi(t,e,i,A,j,C,H,y,I,this).finally(async v=>{await this.waiting(!1)})},async AiSync(o,e,t=d.ai_default_model,i){let n={history:o,text:e,model:t,stream:!1,uuid_search:this.uuid_search,mode:"ai_chat",prompt_mode:!1,extra_key:"__all",extra_data:i??{search_fixer:!0},chat_id:null,language_detail:this.settings.language_detail};return l.apiCall(`${d.api_url}/ai/send`,n,"POST",-1).then(a=>l.notUndefined(a,"choices.0.message.content")??null)},async imageApi(o,e,t,i,n,a,s,r,u){let c=i.extra_data.image_count??1;if((this.credit_detail[e]??!1)&&c*(this.credit_detail[e].cost??1)>this.credit_detail[e].balance&&this.credit_detail[e].credit!=-999&&this.credit_detail[e].credit!="-999"){this.ai_all_response[t][o].forEach((_,h)=>{_.role=="limit"&&delete this.ai_all_response[t][o][h]}),this.ai_all_response[t][o][n].loading=!1,this.ai_all_response[t][o]=Object.values(this.ai_all_response[t][o]),this.ai_all_response[t][o].push({item:"Usage Limit please upgrade plan.",role:"limit",model:e}),await this.setDataStorage(o,t);return}let p={role:"image",item:i.text,loading:!0,images:[]};this.ai_all_response[t][o][n]={...this.ai_all_response[t][o][n],...p},await this.setDataStorage(o,t);let g="/ai/image";return i.extra_data.action!=null&&(g="/ai/image_editing"),l.apiCall(g,i,"POST",-1).then(async _=>{let h=_;typeof h.images>"u"&&(h.images=[]),typeof h.seed>"u"&&(h.seed=null),p.images=h.images||[],p.loading=!1,p.seed=h.seed||null,this.ai_all_response[t][o][n]={...this.ai_all_response[t][o][n],...p},typeof h<"u"&&typeof h.message<"u"&&this.ai_all_response[t][o].push({item:h.message??null,role:h.type??"error",model:e,finish_reason:s,loading:!1}),await this.setDataStorage(o,t);let m={force:1};return this.is_group_chat&&(m.extra_data=this.uuid_extra_data),l.sendMessage("uuid",m),a!=null&&a.forEach(y=>{y.classList.add("aifnmjmchg-hide"),y.classList.remove("aifnmjmchg-show")}),i.extra_data.action!=null&&l.Browser().storage.local.get("image_settings").then(y=>{y.image_settings.image=null,y.image_settings.action=null,l.Browser().storage.local.set(y)}),this.ai_all_response[t][o][n]}).catch(_=>{console.log(_)})},async aiApi(o,e,t,i,n,a,s,r,u,c=this){let p=0;return fetch(r,{headers:{accept:"text/plain",hopekey:this.hopekey??null},body:JSON.stringify(i),method:"POST",signal:this.aborting[t].signal}).then(async g=>{const h=g.body.getReader();let m=async()=>h.read().then(async({value:y,done:T})=>{if(await c.streamFormatter(y,T,t,o,n,p,c),p++,!T)return await m()}).catch(y=>{if(c.waiting(!1),y instanceof DOMException&&y.name=="AbortError"){document.querySelector(".ai_loading")!=null&&document.querySelector(".ai_loading").classList.remove("ai_loading"),c.ai_all_response[t][o][n]._abort=!0;return}else y.message=="network error"?(c.ai_all_response[t][o][n].loading=!1,c.ai_all_response[t][o][n]._error=JSON.stringify(y),console.log(y.message)):(c.ai_all_response[t][o][n].loading=!1,console.log(y.message,y.toString(),y),console.log(c.ai_all_response[t][o]),console.log(u??null),c.ai_all_response[t][o][n]._error=JSON.stringify(y));c.setDataStorage(o,t)});return await m()}).then(g=>{}).catch(g=>{this.waiting(!1),this.ai_all_response[t][o][n].loading=!1,this.ai_all_response[t][o][n].loading=!1;let _='<span class="aifnmjmchg-text-red-600">'+l.__("(Internet connection lost. Please try again)")+"</span>";a!=null&&a.forEach(h=>{h.classList.add("aifnmjmchg-hide"),h.classList.remove("aifnmjmchg-show")}),u.length>0&&(_=u+`

`+_),this.ai_all_response[t][o][n].item=_,c.ai_all_response[t][o][n]._error=JSON.stringify(g),this.setDataStorage(o,t),console.log(g)})},async setData(o,e,t=!0,i=this){let n={};return n[o]={},new Promise(a=>{i.instance===null&&a(!1);let s=i.instance[o];typeof s=="string"&&s!=null&&(s=JSON.parse(s)),e!="__all"&&e!=null&&o!="ai_chat"&&t?(s!=null&&Object.keys(s).length>0&&Object.keys(s).forEach(r=>{n[o][r]=s[r]}),typeof i.ai_all_response[e]<"u"&&typeof i.ai_all_response[e][o]<"u"&&(n[o][e]=i.ai_all_response[e][o])):n[o]=i.ai_all_response[e][o],i.instance.storage&&i.instance.storage.Local&&(i.instance.storage.Local[o]=n[o]),i.instance[o]=n[o],i.instance.$root&&(i.instance.$root[o]=n[o]),i.instance.$data&&(i.instance.$data[o]=n[o]),a(n)})},async setDataStorage(o,e,t=!0){let i={};return i[o]={},await l.Browser().storage.local.get(o).then(async n=>{let a=n[o];return typeof a=="string"&&a!=null&&(a=JSON.parse(a)),e!="__all"&&e!=null&&o!="ai_chat"&&t?(a!=null&&Object.keys(a).length>0&&Object.keys(a).forEach(s=>{i[o][s]=a[s]}),typeof this.ai_all_response[e]<"u"&&typeof this.ai_all_response[e][o]<"u"&&(i[o][e]=this.ai_all_response[e][o]),Object.keys(this.ai_all_response).forEach(s=>{typeof this.ai_all_response[s][o]<"u"&&(i[o][s]=this.ai_all_response[s][o])})):i[o]=this.ai_all_response[e][o],await l.Browser().storage.local.set(i).then(async()=>await this.setData(o,e))})},async streamFormatter(o,e,t,i,n,a=0,s=this){this.last_stream=this.last_stream+new TextDecoder().decode(o,{stream:!0}).toString();let r=this.last_stream,u=r.toString();if(r=r.replace(/"data":\{/gi,'"data": {').replace(/data:\{/gi,"data: {").replace(/"error":\{/gi,'"error": {').replace(/error:\{/gi,"error: {").replace(/\r/,`
`),typeof r.match>"u"){this.ai_all_response[t][i][n].loading=!1;return}const c=r.match(/(\w+): \{(.*)\}/gi);if(r.match(/error: \{(.*)\}/gi),e){this.ai_all_response[t][i][n].loading=!1,await this.processPendingUpdates(t,i),await this.waiting(!1);let _={force:1};this.is_group_chat&&(_.extra_data=this.uuid_extra_data),l.sendMessage("uuid",_),l.scrollToBottom();return}if(c==null&&!e&&a==0){let _=l.JsonParse(r);if(l.notUndefined(_,"error"))return this.ai_all_response[t][i][n].loading=!1,this.ai_all_response[t][i][n].item=l.notUndefined(_,"error.message"),this.ai_all_response[t][i][n].role="error",await this.processPendingUpdates(t,i),await this.waiting(!1),this.ai_all_response[t][i][n].item}if(typeof c!="object"||c===null||!c){this.ai_all_response[t][i][n].loading=!1;let _=l.JsonParse(r);if(_!==null){let h=l.notUndefined(_,"choices.0.delta")??l.notUndefined(_,"choices.0"),m=l.notUndefined(h,"content")??l.notUndefined(h,"message"),y=l.notUndefined(h,"role");y&&m&&h&&(this.ai_all_response[t][i][n].item=m.toString(),this.ai_all_response[t][i][n].role=y)}return await this.setDataStorage(i,t),await this.waiting(!1),this.ai_all_response[t][i][n].item}let p=u.split(/(\w+): (.*)$/gm);p&&p.forEach(async _=>{if(_&&typeof _<"u"){let h=_,m=l.JsonParse(_.trim());if(typeof m=="object")await this.streamToResponseData(m,t,i,n,a),this.queueUpdate(t,i,n,this.ai_all_response[t][i][n].item);else if(h.substring(0,1)=="{"&&h.substring(h.length-1,h.length)=="}"){let y=l.JsonParse(h.trim());await this.streamToResponseData(y,t,i,n,a),this.queueUpdate(t,i,n,this.ai_all_response[t][i][n].item)}}});let g=this.ai_all_response[t][i][n].item;return typeof g<"u"&&g!=""&&g!=null&&(this.last_stream=""),g},async streamToResponseData(o,e,t,i,n=0,a=this){if(l.notUndefined(o,"error.message"))return a.ai_all_response[e][t][i].loading=!1,a.ai_all_response[e][t][i].item=l.notUndefined(o,"error.message"),a.ai_all_response[e][t][i].role="error",V.emit("ai-aifnmjmchgerror",l.notUndefined(o,"error.message")),await a.setDataStorage(t,e),await a.waiting(!1),a.ai_all_response[e][t][i].item;let s=l.notUndefined(o,"choices.0.delta"),r=l.notUndefined(s,"content")??"",u=l.notUndefined(o,"choices.0.finish_reason")??null;if(typeof a.ai_all_response[e]>"u"&&(a.ai_all_response[e]={}),typeof a.ai_all_response[e][t]>"u"&&(a.ai_all_response[e][t]=[]),typeof a.ai_all_response[e][t][i]>"u"&&(a.ai_all_response[e][t][i]={item:"",role:"",loading:!0}),a.ai_all_response[e][t][i].item+=r.toString(),d.debugMode&&console.log(l.notUndefined(o,"finish_text")),l.notUndefined(o,"finish_text"))return a.ai_all_response[e][t][i].item=l.notUndefined(o,"finish_text"),a.ai_all_response[e][t][i].role=l.notUndefined(o,"type")==="error"?"error":"system",a.ai_all_response[e][t][i].prompt=l.notUndefined(o,"prompt"),a.ai_all_response[e][t][i].loading=!1,await a.setDataStorage(t,e),await a.waiting(!1),a.ai_all_response[e][t][i].item;l.notUndefined(a.ai_all_response[e][t],`${i}.model`);let c=parseInt(l.notUndefined(o,"mod")??10);return isNaN(c)&&(c=10),u&&u!==null&&(a.ai_all_response[e][t][i].finish_reason=u,V.emit("ai-aifnmjmchgfinish")),r&&V.emit("ai-aifnmjmchgstream",r),n%c==0||n==1||c<=1?(await a.setDataStorage(t,e),V.emit("ai-aifnmjmchgresponse",a.ai_all_response[e][t][i])):await a.setData(t,e),r},linkify(o){return o==null?"":he.pretty(o)??o},async waiting(o=!0){return V.emit("ai-aifnmjmchgloading",o),o==!1?document.querySelectorAll('[id*="aifnmjmchg-stop-chat-"]').forEach(e=>{e.classList.add("aifnmjmchg-hide"),e.classList.remove("aifnmjmchg-show")}):document.querySelectorAll('[id*="aifnmjmchg-stop-chat-"]').forEach(e=>{e.classList.add("aifnmjmchg-show"),e.classList.remove("aifnmjmchg-hide")}),await l.Browser().storage.local.set({ai_wait:o}).then(()=>l.scrollToBottom())},prefixify(o){if(o==null)return"";let e=this.prompt_prefix.toString();return o=o.toString(),typeof o.replace!="function"||Object.keys(te).forEach(t=>{let i=te[t];Object.keys(i).forEach(n=>{let a=i[n],s=new RegExp(`
${e}${t}_${n}${e}
`.toString(),"gi"),r=new RegExp(`
${e}${t}_${n}${e}`.toString(),"gi"),u=new RegExp(`${e}${t}_${n}${e}
`.toString(),"gi"),c=new RegExp(`${e}${t} ${n}${e}
`.toString(),"gi"),p=new RegExp(`${e}${t}_${n}${e}`.toString(),"gi");o=o.replace(s,a).replace(r,a).replace(u,a).replace(c,a).replace(p,a).replace(/##HIDDEN_CONTEXT_START##.*##HIDDEN_CONTEXT_END##/gs,"")})}),o},async testChat(o,e,t,i,n,a=10){for(let s=0;s<a;s++){typeof this.ai_all_response[e]>"u"&&(this.ai_all_response[e]={}),typeof this.ai_all_response[e][t]>"u"&&(this.ai_all_response[e][t]=[]),this.ai_all_response[e][t]=Object.values(this.ai_all_response[e][t]);let r="";this.ai_all_response[e][t][n]&&typeof this.ai_all_response[e][t][n].item<"u"&&(r=this.ai_all_response[e][t][n].item),this.ai_all_response[e][t][n]={item:r+"TEST"+new Date().toDateString()+"____>"+s,role:"system",model:i},await this.setData(t,e)}},streamRegExBuilder:(o,e,t=!1)=>{let i=null;try{i=e.match(o)[0]??null,i!==null&&t&&(i=i.replace(/(data|error|event|ping|finish): /,""))}catch{i=null}return i},bulkPrettier(o,e=!1){return console.log(o),o&&typeof o=="object"&&Object.keys(o).forEach(t=>{typeof o[t].item<"u"&&typeof o[t].is_prettier>"u"&&o[t].item!==null&&(o[t].item=Q.prefixify(Q.linkify(o[t].item)),e&&(o[t].item=o[t].item.replace(/\n/g,"<br>")))}),o}};typeof window<"u"&&typeof document<"u"&&(window.getCookie=o=>{var e=[];if(o=="*"){let t=document.cookie.split("; ").map(n=>n.split("="))??[];return Object.fromEntries(t)}else e=document.cookie.match(new RegExp("(^| )"+o+"=([^;]+)"));if(e)return e[2]},window.setCookie=(o,e,t,i=null)=>{var n="";if(t){var a=new Date;a.setTime(a.getTime()+t*24*60*60*1e3),n="; expires="+a.toUTCString()}i==null&&(i=window.location.host,window.location.host.split(".").length>2&&(i=window.location.host.split("."),i="."+i.slice(1).join("."))),document.cookie=o+"="+(e||"")+"; "+n+"; path=/; domain="+i+"; secure; SameSite=None"},window.eraseCookie=(o,e=null)=>{e==null&&(e=window.location.host,window.location.host.split(".").length>2&&(e=window.location.host.split("."),e="."+e.slice(1).join("."))),document.cookie=o+"=null; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+e});class _e{notify=se.useToast({duration:5e3,position:"top"});resizeBorder=(e,t=320,i=null)=>{if(e==null)return;let n;`${e.classList}${e.id}`;let a=document.createElement("div");a.classList.add("ai-aifnmjmchgel-resize"),e.append(a);const s=r=>{const u=n-r.x;n=r.x;let c=parseInt(getComputedStyle(e,"").width)+u;c>=t&&(e.style.width=`${c}px`)};return a.addEventListener("mousedown",function(r){r.offsetX<t&&(n=r.x,document.addEventListener("mousemove",s,!1),i&&i(n))},!1),document.addEventListener("mouseup",function(r){document.removeEventListener("mousemove",s,!1)},!1),n};fetchWithTimeout=(e,t={},i=6e4)=>{let n=null,a={...t};if(i>0){let s=new AbortController;n=setTimeout(()=>{s.abort(),clearTimeout(n)},i),a.signal=s.signal}return fetch(e,a).then(function(s){return n!=null&&clearTimeout(n),s}).finally(()=>{n!=null&&clearTimeout(n)})};NodeSearch=(e,t)=>[...e].filter(i=>i.outerHTML.indexOf(t)!==-1);logout=()=>this.apiCall("/auth/logout",{},"POST").finally(()=>(d.domain_allows.forEach(t=>{window.eraseCookie("hopekey","."+t),window.eraseCookie("aifnmjmchg_app","."+t),window.eraseCookie("aitopia_check_login","."+t)}),l.uuid(1).finally(()=>{this.notify&&this.notify.success(this.__("Successfully logged out."))})));storageLocalClearAll=(e=!1)=>{let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","check_extension_expire","check_extension"];return e==!0&&(t=null),chrome.storage.local.get(t).then(i=>(d.debugMode&&console.log(i),l.Browser().storage.local.remove(Object.keys(i))))};sendMessageWindowListener=(e,t,i)=>l.sendMessageListener(e,{},t);sendMessageListener=async(e,t,i,n=!1)=>{let a=[],s=null;if(typeof e.data<"u"&&(a=e.data),s=l.messageExecute(null,e.fn,a,!1,this),s&&typeof s.then=="function"&&n){let r=await s;r&&(s=r)}return i==null?{received:!0,return_data:s}:l.messageSendResponse(s,a,t,i)};sendMessage=(e,t={},i=null,n="scripting",a="runtime",s=null)=>{let r=d.runtime_id!=null?chrome??this.Browser()??{}:this.Browser(),u={fn:e,data:{data:t,callback:i,type:n}},c=p=>({received:!0,return_data:p});if(d.runtime_id===null&&!l.notUndefined(r[a],"sendMessage"))return l.onMessageExecutePre(u,{},c);if(!(typeof r[a]>"u")&&!(typeof r[a].sendMessage>"u"))try{return r[a].sendMessage(s??r.runtime.id??null,u,c)}catch(p){return d.debugMode&&console.log(p),l.onMessageExecutePre(u,{},c)}};onMessageListener=()=>l.notUndefined(l.Browser().runtime,"onMessage")?l.Browser().runtime.onMessage.hasListener(l.onMessageExecutePre)?new Promise(e=>e(!1)):l.Browser().runtime.onMessage.addListener(l.onMessageExecutePre):new Promise(e=>e(!1));onMessageExecutePre=(e,t,i)=>{let n=[],a=null;return l.notUndefined(e,"data")&&(n=e.data),a=l.messageExecute(null,l.notUndefined(e,"fn")??null,n),l.messageSendResponse(a,n,t,i)};messageExecute=(e,t,i,n=!1,a={})=>{let s=null,r=i;l.notUndefined(r,"data")&&(r=r.data);let u=[],c=["object","function"],p={};if(self!=null&&(p=self),t!=null&&typeof t!="function"&&(u=typeof t=="string"?t.split("."):t,e==null)){let g=[typeof a<"u"?a:null,typeof p<"u"?p:null,typeof this<"u"?this:null,typeof ServiceWorkerGlobalScope<"u"?ServiceWorkerGlobalScope:null,typeof l<"u"?l:null,l.notUndefined(this,"Browser")?this.Browser():null];if(typeof u.forEach<"u"&&u.forEach(_=>{if(s==null){if(c.indexOf(typeof _)!==-1)s=this.messageExecute(null,_,r,n);else for(const h of g)if(h!=null&&l.notUndefined(h,_)&&c.indexOf(typeof h[_])!==-1){s=this.messageExecute(null,h[_],r,n);break}}else s=s[_]??null}),typeof s!="function")return s??null;t=s}if(e!=null){if(typeof e[t]=="object"&&typeof e[t].then>"u"||n===!0)return e[t]}else if(n===!0)return t;if(typeof t=="object"&&t!=null&&typeof t.then=="function")return t();if(e==null&&typeof t=="object")return t;try{return e==null&&typeof t=="function"?Array.isArray(r)?t(...r):t(r):e==null&&t!=null?t:typeof e=="object"&&typeof e[t]=="function"?Array.isArray(r)?e[t](...r):e[t](r):e==null?void 0:typeof e[t]<"u"&&typeof e[t].then>"u"&&typeof e=="object"?e:Array.isArray(r)?e[t](...r):e[t](r)}catch{return e==null&&typeof t=="function"?t():e==null&&t!=null?t:e==null?void 0:typeof e[t]<"u"&&typeof e=="object"&&typeof e[t]=="function"?e[t]():typeof e=="object"&&typeof e[t].then>"u"?e:e[t]()}};messageSendResponse=(e,t,i,n,a={})=>{let s=null,r=l.notUndefined(t,"type")??"scripting",u=l.notUndefined(t,"callback")??null;if(u){s=this.messageExecute(null,t.callback,e,!0,a);let c=s.name;t.callback=s,t.callback_name=c}if(e==null)return n({received:!0,return_data:e});if(typeof e=="object"&&typeof e.then=="function"){let c=e.then(p=>{if(typeof p<"u"&&typeof p.text<"u"&&(p=p.text()),typeof p<"u"&&typeof p.json<"u"&&(p=p.json()),typeof t.callback<"u"&&t.callback){let g=this.messageExecute(null,t.callback,p,!0,a),_=g.name;if(t.callback=g,t.callback_name=_,r=="scripting")if(i==null)g(p,t);else{let h={target:{tabId:i.tab.id},function:g,args:[p,t]};l.Browser().scripting.executeScript(h).then()}else{let h=l.notUndefined(i.tab,"id")??null;h!=null&&d.runtime_id==null?(u=this.messageExecute(null,u,{result:p,data:t},!0,a),u&&u(p,t)):l.sendMessage(u,{data:{result:p,data:t}},null,"tabs","tabs",h)}}return p});return n({received:!0,return_data:c})}if(typeof t.callback<"u"&&t.callback!=null&&s!=null&&typeof t.callback=="function"){let c=this.messageExecute(null,t.callback,e,!0,a),p=c.name;if(t.callback=c,t.callback_name=p,r=="scripting")if(i==null)c(e,t);else{let g={target:{tabId:i.tab.id},function:c,args:[e,t]};l.Browser().scripting.executeScript(g).then()}else{let g=l.notUndefined(i.tab,"id")??null;g!=null&&d.runtime_id==null?(p=this.messageExecute(null,p,{result:e,data:t},!0,a),p&&p(e,t)):l.sendMessage(p,{data:{result:e,data:t}},null,"tabs","tabs",g)}}return n({received:!0,return_data:e})};customAddListener=(e,t=[],i=[])=>{t.forEach(n=>{e[n].addListener((a,s,r)=>{let u=!1;typeof a.status<"u"&&(s=a,r=a,a=r.id),typeof s<"u"?typeof s.status<"u"&&typeof r.url<"u"&&s.status==="complete"&&r.url.indexOf("chrome://")===-1&&(u=!0):(typeof a.name<"u"||typeof a.title<"u"||Object.keys(a).length>0)&&(u=!0),u&&i.forEach(c=>{let p=!1;typeof c=="function"?c(a,s,r):(typeof window<"u"&&p===!1&&typeof window[c]=="function"&&typeof window[c].apply=="function"&&(window[c].apply(a,s,r),p=!0),typeof ServiceWorkerGlobalScope<"u"&&p===!1&&typeof ServiceWorkerGlobalScope[c]=="function"&&ServiceWorkerGlobalScope[c](a,s,r),typeof this<"u"&&p===!1&&typeof this[c]=="function"&&this[c].call(a,s,r))})})})};apiCall=async(e,t={},i="GET",n=6e4)=>{t==null&&(t={}),d.debugMode&&console.log(e,t,"Call");let a={headers:{accept:"application/json",hopekey:f.Local.uuid_hopekey??null},method:i};d.runtime_id!=null&&e=="/extensions/app/get_key"&&a.headers.hopekey==null&&delete a.headers.hopekey,d.runtime_id==null&&typeof window<"u"&&typeof window.getCookie=="function"&&(a.headers.hopekey=window.getCookie("hopekey")??f.Local.uuid_hopekey??null,a.headers.hopekey==null&&delete a.headers.hopekey);let s=e;if(e.indexOf("://")===-1){if(s=`${d.api_url}${e}`,typeof f.Local<"u"){let r=f.Local;typeof r.settings<"u"&&l.notUndefined(r.settings,"language")&&(t.lang=r.settings.language)}typeof t.uuid_search>"u"&&l.notUndefined(f.Local,"uuid_search")&&(t.uuid_search=l.notUndefined(f.Local,"uuid_search")),typeof t.uuid_hopekey>"u"&&l.notUndefined(f.Local,"uuid_hopekey")&&(t.uuid_hopekey=l.notUndefined(f.Local,"uuid_hopekey")),d.runtime_id!=null?(t.v=d.version??null,t.ri=l.Browser().runtime.getManifest().id??d.runtime_id,l.notUndefined(f.Local,"check_extension_delete")&&(t.rif=!0,delete f.Local.check_extension_delete,l.Browser().storage.local.remove("check_extension_delete")),t.bt=d.build_type):t.v=d.version??null}return Object.keys(t).length>0&&(a.body=JSON.stringify(t)),await l.fetchWithTimeout(s,a,n).then(r=>{try{return r.json()}catch{return r.text()}}).then(r=>{r=this.ajaxResponse(this.ajaxResponseChipper(r),0,1),d.debugMode&&console.log(e,t,r);try{return r&&typeof r=="object"&&typeof r.modal=="object"&&this.announcementModal(r.modal),r}catch{return r}}).catch(r=>{if(d.api_call_try<d.api_call_max_try&&s.indexOf("languages/lang/sync")===-1)return setTimeout(()=>(console.log("Try",d.api_call_try,s,t,i,n,r),d.api_call_try++,l.apiCall(e,t,i,n)),3e4);if(d.api_call_try<d.api_call_max_try*2&&s.indexOf("languages/lang/sync")===-1)return setTimeout(()=>(console.log("Try",d.api_call_try,s,t,i,n,r),d.api_call_try++,l.apiCall(e,t,i,n)),12e4)})};ajaxResponse=(e,t=0,i=1)=>{if(typeof e>"u")return!1;if(t==1)return;if(typeof e.debug_time<"u"&&d.debugMode!=2)if(d.debugMode==1)console.log(e.redirect_uri,e.debug_time);else{let a={[e.redirect_uri]:e.debug_time};d.debug_time=Object.assign(d.debug_time,a)}let n={};return typeof e.languages<"u"&&(n.languages=e.languages,typeof f.Local<"u"&&(f.Local.languages=e.languages),typeof e.expire<"u"&&l.Browser().storage.local.get("expires").then(a=>{n.expires=a.expires??{},typeof n.expires!="object"&&(n.expires={}),n.expires.languages=e.expire,f.Local.expires=n.expires,l.Browser().storage.local.set({expires:n.expires}).then(d.debugMode?console.log:null)})),typeof e.expire<"u"&&typeof e.expire.name<"u"&&typeof e.expire.time<"u"&&l.Browser().storage.local.get("expires").then(a=>{n.expires=a.expires??{},typeof n.expires!="object"&&(n.expires={}),n.expires[e.expire.name]=e.expire.time,f.Local.expires=n.expires,l.Browser().storage.local.set(n).then(d.debugMode?console.log:null)}),typeof e.language_variables<"u"&&typeof e.language_variables.variables<"u"&&(n.language_variables=e.language_variables.variables,typeof f.Local<"u"&&(f.Local.language_variables=e.language_variables.variables)),typeof e.data<"u"&&typeof e.data.eref<"u"&&f.Local.check_extension!=d.manuel_extension_id&&(n.check_extension=l.notUndefined(e.data,"eref")??null,typeof f.Local<"u"&&(f.Local.check_extension=n.check_extension)),typeof n=="object"&&Object.keys(n).length>0&&(d.debugMode&&console.log(n,e,"STORAGE_SET"),l.Browser().storage.local.set(n).then(d.debugMode?console.log:null)),typeof e.notifications<"u"&&typeof document<"u"&&e.notifications&&Object.keys(e.notifications).forEach(a=>{a=e.notifications[a],typeof this.notify[a.type]<"u"&&this.notify[a.type](a.message)}),typeof e.data<"u"&&i==1?e.data:e};firstUpperCase=e=>`${e.substring(0,1).toUpperCase()}${e.substring(1)}`;ucFirstUpperCase=(e,t)=>{let i=e.split(t);return i.forEach((n,a)=>{i[a]=`${n.substring(0,1).toUpperCase()}${n.substring(1)}`}),i.join(t)};JsonParse=e=>{let t=e;if(typeof e<"u"||e!=null)try{typeof e=="string"&&(t=JSON.parse(e)),typeof t=="object"&&Object.keys(t).length>0&&Object.keys(t).forEach(i=>{(typeof t[i]=="object"||typeof t[i]=="string"&&(t[i].indexOf("{")!==-1&&t[i].indexOf("}")!==-1||t[i].indexOf("[")!==-1&&t[i].indexOf("]")!==-1))&&(t[i]=this.JsonParse(t[i]))})}catch{}return t};settingsBuild=async(e=!1)=>new Promise(async(t,i)=>await l.Browser().storage.local.get(["settings","domain","languages"]).then(async n=>{if(typeof n.domain>"u"&&n.domain!=null&&l.domainByUrls(n.domain),n.settings){let a=!1;n.settings.language!==null&&(l.notUndefined(n.settings,"language_detail.lang_code")!==n.settings.language&&(a=!0),a&&n.settings.language!==null&&(b.language_detail=n.settings.language_detail=l.notUndefined(n.languages,`${n.settings.language}`),b.language_name=n.settings.language_name=l.notUndefined(n.languages,`${n.settings.language}.title`)))}return typeof n.settings>"u"?await l.Browser().storage.local.set({settings:b}).then(async()=>(await l.getLanguages(!0,b.language).then(),l.getActiveHistories(),await l.getModelSettings(),l.removeLoading(),t(b))):(Object.keys(b).forEach(a=>{if(typeof b[a]<"u"){let s=b[a];n.settings&&typeof n.settings[a]>"u"&&(n.settings[a]=s)}}),n.settings&&l.Browser().storage.local.set({settings:n.settings}).then(async()=>{e==!0&&(await l.getLanguages(!1,n.settings.language).then(),await l.getModelSettings(),await l.uuid(e==!0?1:0))}),l.removeLoading(),t(n))}));uuid=async(e=0,t={})=>{if(l.removeFirstLoading(),typeof e=="object"){let i=e;typeof i.extra_data<"u"&&typeof i.force<"u"&&(t=i.extra_data,e=i.force)}return new Promise(async(i,n)=>await l.Browser().storage.local.get().then(async a=>{f.Local=a,typeof a.developer<"u"&&a.developer!=null&&(l.notUndefined(a.developer,"beta_api")&&(d.api_url=`https://beta_api.${d.domain}`),l.notUndefined(a.developer,"debug_log")&&(d.debugMode=1)),l.Browser().storage.sync&&l.Browser().storage.sync.get().then(async r=>{f.Sync=r}),l.notUndefined(a,"settings")||(a.settings=b),a.settings==null&&(a.settings=b,a.settings.language=b.language,l.Browser().storage.local.set({settings:a.settings}).then()),d.debugMode&&console.log(b,365),typeof a.settings==null&&(a.settings=b),d.debugMode&&console.log(a.settings,367),typeof a.settings<"u"&&a.settings!=null&&typeof a.settings.ai_mode>"u"&&(a.settings=b);let s={ai_mode:a.settings.ai_mode,lang:a.settings.language,model:a.settings.ai_model,settings:a.settings};if(e||d.runtime_id==null&&typeof window<"u"&&(a.uuid_hopekey!=(window.getCookie("hopekey")??"nullS")||window.getCookie("aitopia_check_login"))&&(window.eraseCookie("aitopia_check_login"),e=1),!e&&typeof a.credit_usage<"u"&&(a.uuid_hopekey??null)!=null){l.removeLoading();return}return s.ai_mode=="api"&&(s.ai_key=a.settings.ai_key),l.notUndefined(s.settings,"language_detail.variables")&&(delete s.settings.language_detail.variables,l.Browser().storage.local.set({settings:s.settings}).then()),typeof t<"u"&&t!==null&&Object.keys(t).length>0&&(s.extra_data=t),await this.apiCall("/extensions/app/get_key",s,"POST").then(r=>{if(!r)return;let u=r;if(typeof u.key<"u"){f.Local.uuid_hopekey=u.key;let c={licences:u.licences,credit_usage:u.credit_usage,credit_detail:u.credit_detail,credit_detail_visual:u.credit_detail_visual,ai_models:u.models,ai_type_models:u.type_by_models,image_editing:u.image_editing,google_auth_uri:u.google_auth_uri??null,user:null,email:null,uuid_hopekey:u.key,uuid_search:u.search_key,plan:u.plan.toCapitalizeCase(),pricing_page_title:u.pricing_page_title};l.notUndefined(u,"domain")&&(c.domain=u.domain,l.domainByUrls(u.domain)),typeof u.show_review<"u"&&(c.show_review=u.show_review),f.Local.settings&&u.plan=="free"&&typeof f.Local.settings.web_access<"u"&&(f.Local.settings.web_access=!1,c.settings=f.Local.settings),typeof u.user<"u"&&(c.user=u.user,typeof u.user.email<"u"&&(c.email=u.user.email)),typeof u.expire<"u"&&(l.notUndefined(f.Local,"expires")||(f.Local.expires={}),f.Local.expires.credits=u.expire,c.expires=f.Local.expires,d.debugMode&&console.log(f.Local.expires),d.debugMode&&console.log(c)),typeof window<"u"&&c.uuid_hopekey!=null&&d.domain_allows.forEach(g=>{window.setCookie("hopekey",c.uuid_hopekey,360,"."+g),l.Browser().runtime.id!==d.manuel_extension_id&&l.Browser().runtime.id&&window.setCookie("eref",l.Browser().runtime.id,360,"."+g),window.setCookie("aifnmjmchg_app",!0,360,"."+g),window.eraseCookie("aitopia_check_login","."+g)}),l.Browser().storage.local.set(c).then(()=>l.removeLoading()),f.Local=Object.assign(f.Local,c)}return i(u)}).catch(r=>(console.log(r),n()))}))};pricingDetail=(e=!1)=>l.Browser().storage.local.get().then(t=>{if(f.Local=t,typeof t.packages<"u"&&(t.packages==null||t.packages=="")&&delete t.packages,typeof t.packages>"u"||e==!0)return this.apiCall("/extensions/app/get_pricing",null,"POST").then(i=>{let n=i;if(n&&typeof n.packages<"u"){let a=n;typeof a.expire<"u"&&delete a.expire,f.Local=Object.assign(f.Local,a),typeof f.Local.expires>"u"&&(f.Local.expires={}),f.Local.expires.packages=n.expire,l.Browser().storage.local.set(a).then()}})});ajaxResponseChipper=e=>{if(typeof e!="string")return e;try{return JSON.parse(M.AES.decrypt(e,"",{format:this.CryptoJSAesJson}).toString(M.enc.Utf8))}catch(t){throw console.log(t),"error"}};CryptoJSAesJson={stringify:function(e){var t={ct:e.ciphertext.toString(M.enc.Base64)};return e.iv&&(t.iv=e.iv.toString()),e.salt&&(t.s=e.salt.toString()),e.key&&(t.k=e.key.toString()),JSON.stringify(t)},parse:function(e){try{let n=M;var t=JSON.parse(e);if(typeof t=="string"&&(t=JSON.parse(t)),t==null)return e;var i=n.lib.CipherParams.create({ciphertext:n.enc.Base64.parse(t.ct)});return t.iv&&(i.iv=n.enc.Hex.parse(t.iv)),t.s&&(i.salt=n.enc.Hex.parse(t.s)),t.k&&(i.key=n.enc.Hex.parse(t.k)),i}catch(n){throw console.log(n),"error"}}};_i;AesEnCrypt(e,t=null){let i=M;this._i=i.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:256/32,iterations:100});var n=i.AES.encrypt(e,this._i,{iv:this._i,padding:i.pad.Pkcs7,mode:i.mode.CBC,hasher:i.algo.SHA256});return n.toString()}AesDeCrypt(e,t=null){let i=M;this._i==null&&(this._i=i.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:256/32,iterations:100}));var n=i.AES.decrypt(e,this._i,{iv:this._i,padding:i.pad.Pkcs7,mode:i.mode.CBC,hasher:i.algo.SHA256});return n.toString(i.enc.Utf8)}copyClipboard=e=>{let t=document.querySelector("#aifnmjmchg_clipboard");t.value=e,t.focus(),t.select(),document.execCommand("copy",!1,e),t.value="",this.notify&&this.notify.success(this.__("Copied."))};openPage=e=>{if(d.runtime_id==null){e.url.indexOf(`.${d.main_dir}`)===0||e.url.indexOf(`${d.main_dir}`)===0?window.location=e.url.replace(`.${d.main_dir}`,"").replace(`${d.main_dir}`,"").replace(".html",""):window.location=e.url;return}l.Browser().tabs.create({url:e.url}).then()};messageCallback(e,t){e(t)}notUndefinedBuilder=(e,t)=>t.indexOf(".")!==!1?(t.split(".").forEach(n=>{n=n.replace("###","."),typeof e<"u"&&e&&(typeof e[n]<"u"?e=e[n]:e=null)}),e):typeof e<"u"&&e&&typeof e[t]<"u"?e[t]:!1;notUndefined=(e,t)=>{if(t==null)return!1;if(typeof t=="string")return this.notUndefinedBuilder(e,t);if(typeof t=="object"){let i=!0;return t!=null?t.forEach(n=>{this.notUndefinedBuilder(e,n)||(i=!1)}):i=!1,i}return null};SHA1=e=>(e=e+"_crypt",M.SHA1(e).toString());MD5=e=>(e=e+"_md5",M.MD5(e).toString());isPinned=e=>{if(e!=null&&document.querySelector(".setup_page #check_toolbar")){let i=document.querySelector(".setup_page #check_toolbar");if(e.isOnToolbar==!0){i.value=e.isOnToolbar;var t=new Event("change");i.dispatchEvent(t)}}};minifierExpand=(e,t)=>{let i={};return e&&t?(Object.keys(e).forEach(n=>{let a=e[n];a&&Object.keys(a).forEach(s=>{let r=a[s];typeof i[n]>"u"&&(i[n]={}),i[n][t[s]]=this.JsonParse(r)})}),i):e};filenameByFaIcon(e,t=null){let i=null;const n={excel:["xlsx","xls"],word:["doc","docx"],powerpoint:["pptx","ppt"],pdf:["pdf"],image:["jpg","jpeg","webp","png","tiff","svg","gif","avif","apng"],video:["webm","mkv","flv","flv","vob","ogv","ogg","drc","gif","gifv","mng","avi","MTS","M2TS","TS","mov","qt","wmv","yuv","rm","rmvb","viv","asf","amv","mp4","m4p","m4v","mpg","mp2","mpeg","mpe","mpv","mpg","mpeg","m2v","m4v","svi","3gp","3g2","mxf","roq","nsv","flv","f4v","f4p","f4a","f4b"],zipper:["zip","rar","7z"],audio:["mp3","wav","ogg","flac","aac","wma","m4a","ape","alac","aiff","mid","amr","pcm","au","ra","aac","ac3","dts","mka","opus","midi","3ga","webm","caf","m4r","tta","wv"],code:["php","html","css","js","py","java","c","cpp","h","hpp","xml","json","sql","rb","swift","kt","pl","go","ts","dart","sh","bat","ps1"]},a={excel:"#1d6f42",word:"#41A5EE",powerpoint:"#D04423",pdf:"#f40f02"};return Object.keys(n).forEach(s=>{n[s].forEach(u=>{if(e.indexOf(`.${u}`)!==-1)return i=s,t==null&&(t=a[s]??t),{name:i,color:t}})}),i==null&&(i="lines"),t==""&&(t=null),{name:i,color:t}}async getModelSettings(){return await new Promise(async(e,t)=>await l.Browser().storage.local.get("model_settings").then(async i=>{if(typeof i.model_settings<"u"&&i.model_settings!=null&&Object.keys(i.model_settings).length>0)return await e(i.model_settings);await l.apiCall("/ai/model_settings",{},"POST").then(async n=>n?(await l.Browser().storage.local.set({model_settings:n}),n):setTimeout(l.getModelSettings,1e3)),e(i)}))}slugify=e=>e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");vueDefaultChecker(e,t,i,n,a=null,s=!0){if(i=l.notUndefined(i,l.notUndefined(n,"model_prefix")),s==!1){if(a!=null&&i!=null)return i!=a?null:a}else return i===a;let r=l.notUndefined(e,t);if(r!=null)return r;let u=r??l.notUndefined(e,l.notUndefined(n,"model_default"))??a??l.notUndefined(n,"default"),c=!0;return typeof i<"u"&&(c=i==u),s==!1?typeof u>"u"?null:u:(c==!0&&u!=null&&l.notUndefined(f.Local,t)!=u,c)}autoHeightTextArea(e,t=null){e.style.height="unset",t==null&&(t=e.style.maxHeight.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/)[0]??200),t<=e.scrollHeight&&(e.style.height=e.scrollHeight+"px")}getReadableFileSizeString(e){var t=-1,i=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do e=e/1024,t++;while(e>1024);return Math.max(e,.1).toFixed(2)+i[t]}__(e,t="tr"){if(e==null)return e;let i=M.SHA1(e).toString(),n=d.lang_cache_type;return b!=null&&typeof f.Local.languages=="object"&&typeof b.language<"u"&&f.Local.languages!==null&&b.language!==null&&typeof f.Local.languages[b.language]<"u"&&(b.language_name==null||b.language_name=="")&&typeof f.Local.languages[b.language].name<"u"&&typeof f.Local.settings<"u"&&(l.notUndefined(f.Local,"settings.language")&&(b.language=l.notUndefined(f.Local,"settings.language")),f.Local.settings.language_name=b.language_name=f.Local.languages[b.language].name,f.Local.settings.language_detail=b.language_detail=f.Local.languages[b.language],l.Browser().storage.local.set({settings:f.Local.settings}).then()),typeof f<"u"&&b.language_name!==null&&typeof f[n]<"u"&&l.notUndefined(f[n],"language_variables")&&typeof f[n].language_variables[i]<"u"?f[n].language_variables[i]:(e=this.setLangVar(i,e),e)}async getLanguages(e=!1,t=null,i=null){let n=d.lang_cache_type;t=t??f[n].settings.language??b.language;let a=!1;if(typeof f[n].languages<"u"&&(Object.keys(f[n].languages??{}).length==0||f[n].languages==null||f[n].languages=="{}")&&(delete f[n].languages,delete f[n].language_variables,delete f[n].language_var_sync),typeof f[n].languages>"u"||e)return i!=null&&(f[n].settings.language=i.settings.language=t),typeof f[n].languages>"u"&&(f[n].languages={},a=!0),await l.apiCall("/languages/lang/get/lang/"+t,{language:t},"POST").then(s=>{try{return typeof s>"u"||typeof s.languages>"u"?void 0:(s=l.JsonParse(s),a&&l.Browser().storage[n.toLowerCase()].set({languages:JSON.stringify(s.languages)}).then(),typeof s.expire<"u"&&(l.notUndefined(f.Local,"expires")||(f.Local.expires={}),f.Local.expires.languages=l.JsonParse(s.expire),l.Browser().storage[n.toLowerCase()].set({expires:f.Local.expires}).then()),f[n].language_variables=l.JsonParse(s.language_variables.variables),f[n].languages=l.JsonParse(s.languages),l.Browser().storage[n.toLowerCase()].set({language_variables:JSON.stringify(s.language_variables.variables),languages:f[n].languages}).then(r=>l.Browser().storage[n.toLowerCase()].get("settings").then(u=>(f[n].settings=u.settings??b,f[n].settings.language_name=b.language_name=f[n].languages[t].name,f[n].settings.language_detail=b.language_detail=f[n].languages[t],f[n].settings.language=b.language=t,l.Browser().storage.local.set({settings:f[n].settings}).catch(c=>console.log(c)).finally(()=>{typeof i<"u"&&i!=null&&typeof i.changeSettings=="function"&&(i.changeSettings(),Object.keys(i.ai_chat).length==1&&typeof i.newChat=="function"&&i.newChat()),l.Browser().tabs&&l.Browser().tabs.query({url:d.site+"/*"}).then(c=>{c.forEach(p=>{t!=null&&l.Browser().scripting!=null&&p.status=="complete"&&l.Browser().scripting.executeScript({target:{tabId:p.id},func:this.changeSiteLanguage,args:[t]}).catch(g=>{console.warn(g,p)}).then()})})})))))}catch(r){console.log(r)}})}changeSiteLanguage=(e=null)=>{if(e==null){let i=f.Local;typeof i.settings<"u"&&typeof i.settings.language<"u"&&i.settings.language!=null&&(e=i.settings.language)}if(e==null)return;window.lang=e,localStorage.getItem("lang")!=window.lang&&(localStorage.setItem("lang",e),localStorage.removeItem("languages"),localStorage.removeItem("language_variables"))};setLangVar(e,t){let i=d.lang_cache_type,n=!1;if(t!=null&&!(typeof f>"u")&&!(typeof f[i]>"u"))return typeof f[i].language_variables>"u"&&(f[i].language_variables={}),l.notUndefined(f[i],"language_variables")||(f[i].language_variables={}),l.notUndefined(f[i].language_variables,e)||(n=!0),typeof f[i].language_variables=="string"&&f[i].language_variables!=null&&(f[i].language_variables=JSON.parse(f[i].language_variables)),typeof f[i].language_variables!="object"&&(f[i].language_variables=[]),f[i].language_variables&&(f[i].language_variables[e]=t),d.mode!="development"||t&&n==!1||(typeof f[i].language_var_sync>"u"&&(f[i].language_var_sync={}),(typeof f[i].language_var_sync!="object"||f[i].language_var_sync==null)&&(f[i].language_var_sync={}),f[i].language_var_sync[e]=t,l.Browser().storage[i.toLowerCase()].set({language_var_sync:JSON.stringify(f[i].language_var_sync)}).then()),t}async captureCurrentViewport(){return new Promise((e,t)=>{console.log(l.Browser().tabs,l.Browser().tabs.captureVisibleTab),l.Browser().tabs.captureVisibleTab(void 0,{format:"jpeg",quality:80}).then(i=>i?e(i):t(null))})}setAIImageURL(e){let t=d.lang_cache_type;typeof f[t]>"u"||(l.Browser().storage[t.toLowerCase()].set({ai_image_url:e}).then(),typeof f[t].ai_image_url>"u"&&(f[t].ai_image_url={}),f[t].ai_image_url=e)}syncLangVar(){setTimeout(()=>{if(d.mode!="development")return;let e=d.lang_cache_type;if(l.Browser().storage[e.toLowerCase()].set({language_var_sync:JSON.stringify(f[e].language_var_sync)}).then(),l.Browser().storage[e.toLowerCase()].set({language_variables:JSON.stringify(f[e].language_variables)}).then(),typeof f[e].language_var_sync<"u"){if(!l.notUndefined(f[e],"language_var_sync"))return;let t=f[e].language_var_sync;if(Object.keys(t).length>0){let i={data:t,language:"en"};l.apiCall("/languages/lang/sync",i,"POST",-1).then(n=>{l.Browser().storage[e.toLowerCase()].remove(["language_var_sync"]).then()})}}},2e3)}auth(e,t,i="register",n){let a=n.target,s=!1;a.setAttribute("disabled","disabled");let r=a.closest(`#${i}`);document.querySelectorAll(".input-error").forEach(c=>{c.classList.remove("input-error")});let u=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(t.email==null&&(t.email=""),(t.email.length<3||!t.email.match(u))&&(r!=null&&r.querySelector('[name="email"]').classList.add("input-error"),this.notify.error(this.__("Please check your e-mail address.")),s=!0,a.removeAttribute("disabled")),i=="register")return t.password==null&&(t.password=""),t.password1==null&&(t.password1=""),t.agree==null&&(t.agree=!1),t.password.length<3&&(r!=null&&r.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),a.removeAttribute("disabled"),s=!0),t.password1.length<3&&(r!=null&&r.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Please check your confirm password.")),a.removeAttribute("disabled"),s=!0),t.password1!=t.password&&(e.forms.password1=null,r!=null&&r.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Your passwords do not match. Please check and try again.")),a.removeAttribute("disabled"),s=!0),t.agree==!1&&(r!=null&&r.querySelector('[name="agree"]').classList.add("input-error"),this.notify.error(this.__("I have read and agree to terms.")),a.removeAttribute("disabled"),s=!0),s==!0?void 0:this.apiCall("/auth/register",t,"POST").then(c=>{if(typeof c.status<"u"&&c.status=="error"){a.removeAttribute("disabled");return}return this.uuid(1).then(()=>{e.login=!0,a.removeAttribute("disabled")})});if(i=="login")return t.password==null&&(t.password=""),t.password.length<3&&(r!=null&&r.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),a.removeAttribute("disabled"),s=!0),s==!0?void 0:this.apiCall("/auth/login",t,"POST").then(c=>{if(typeof c.status<"u"&&c.status=="error"){a.removeAttribute("disabled");return}return c.status=="success"?this.uuid(1).then(()=>{e.login=!0,a.removeAttribute("disabled")}):c});if(i=="recover")return s==!0?void 0:this.apiCall("/auth/reset_password",t,"POST").then(c=>{if(typeof c.status<"u"&&c.status=="error"){a.removeAttribute("disabled");return}return c.status=="success"?(e.login_type="login",a.removeAttribute("disabled"),!0):c})}scrollToBottom(e="#ai-aifnmjmchgmessage-container,#aifnmjmchg-prompt-container",t=null){document&&document.querySelectorAll(e).forEach(i=>{let n=i;setTimeout(()=>{typeof n.scrollTop<"u"&&(n.scrollTop=t??n.scrollHeight+1e3*50)},75)})}newChatId(){return Date.now()}ChatId(e,t,i=0){let n=null,a=f.Local.ai_chat_ids??{};return typeof a<"u"&&i==0&&typeof a[e]<"u"&&(t!=null&&t!="__all"?(a[e][t]||typeof a[e]=="number")&&(n=a[e][t]):n=a[e]),n==null&&(i=1),e&&i==1&&(t?((typeof a[e]>"u"||typeof a[e]!="object")&&(a[e]={}),n=a[e][t]=this.newChatId()):n=a[e]=this.newChatId()),l.Browser().storage.local.set({ai_chat_ids:a}).then(),n}GoogleSearchCall=async e=>{if(d.runtime_id==null)return!1;let t=l.notUndefined(f.Local,"settings.language")??null;if(t==null)try{return fetch("https://www.google.com/search?q="+e+"&sourceid=chrome&ie=UTF-8").then(i=>i.text()).catch(console.log)}catch{return!1}try{return fetch(`https://www.google.com/search?hl=${t}&lr=lang_${t}&as_q=${e.replace(/ /gi,"+")}&sourceid=chrome&ie=UTF-8`).then(i=>i.text()).catch(console.log)}catch{return!1}};GoogleSearchCallback=async(e,t={},i=!0)=>{let n=null;typeof e=="object"&&typeof e.result<"u"&&(t=e.data??{},e=e.result??{},n=l.notUndefined(t,"data"));let s=new DOMParser().parseFromString(e,"text/html"),r="",u={},c=0,p="",g="",_={},h=s.querySelector("#search block-component table");h!=null&&(h=h.outerHTML);let m="";if(h!=null){let w=s.querySelectorAll("#search block-component table");s.querySelector("#search block-component table table")!=null&&(w=s.querySelectorAll("#search block-component table table")),w.forEach(E=>{E=E,E.querySelectorAll("tr").forEach((A,j)=>{let P=A;P.querySelector("th")!=null?(P.querySelectorAll("th").forEach(C=>{let U=C;U.querySelector('span[aria-hide],[class*="hide"]')!=null?U.querySelector("* span:last-child")!=null&&(m+="  "+U.querySelector("* span:last-child").innerText.trim()):m+="  "+U.innerText.trim()}),m=m.trim()+`
`):(P.querySelectorAll("td").forEach(C=>{let U=C;U.querySelector("span[aria-hide]")!=null?U.querySelector("* span:last-child")!=null&&(m+="  "+U.querySelector("* span:last-child").innerText.trim()):m+="  "+U.innerText.trim()}),m=m.trim()+`
`)})})}s.querySelectorAll("#search [data-snc]")!=null&&s.querySelectorAll("#search [data-snc]").forEach((w,E)=>{Object.keys(u).length<=(d.web_access_search_limit??5)&&(w.querySelectorAll("[data-sncf],[data-snhf]").forEach((A,j)=>{let P=!1,C=A,U=C.querySelector("a h3"),H=null;if(U!=null&&(P=!0,p=U.closest("a").getAttribute("href"),g=U.innerText),P||(H=C.querySelectorAll("a"),H!=null&&H.forEach(D=>{_[D.innerText]=D.getAttribute("href")})),C.innerHTML.indexOf('role="img"')===-1&&!P){let D=C.innerText.split(" — ");r+=D[1]??D[0]}C.getAttribute("data-sncf")}),u[c]={text:r,url:p,title:g,sub_links:_},g=p=r="",_={},c++)});let y=null;s.querySelector("#search [data-entityname] [data-domdiff]")!=null&&(y=s.querySelector("#search [data-entityname] [data-domdiff]").innerText.replace(/\n/gi," ")??null);let T=[];s.querySelector("#search [data-q]")!=null&&s.querySelectorAll("#search [data-q]").forEach(w=>{T.push(w.innerText)});let x="";s.getElementById("rhs")!=null&&(s.querySelector("g-card-section")!=null&&s.querySelectorAll("g-card-section").forEach(w=>{if(w=w,w.closest('[role="button"]')==null){let E=w.innerText;E.length>0&&(x+=`
`+E)}}),s.querySelector("#rhs g-link")!=null&&s.querySelectorAll("#rhs g-link").forEach(w=>{if(w=w,w.closest('[role="button"]')==null){let E=w.innerText;E.length>0&&(x+=`
`+E)}}),s.querySelectorAll("#rhs [data-maindata]+div span,#rhs [data-maindata]+div .title").forEach(w=>{let E=w;E.closest('[role="button"]')==null&&E.innerText&&(x+=`
`+E.innerText)}),x==""&&(x=x.trim()));let q={};try{q={original_ask:n,data:u,extra:y,questions:T,detail:x,table:m}}catch{}let I=!1;if(Object.keys(l.notUndefined(q,"data")).length>0&&(I=!0),!I&&(l.notUndefined(e,"data.data")||l.notUndefined(t,"data"))){let w=await this.apiCall("/ai/search",{q:l.notUndefined(e,"data.data")||l.notUndefined(t,"data"),lang_code:l.notUndefined(f.Local,"settings.language")??null,model:b.ai_model},"POST");l.notUndefined(w,"data")&&(q={original_ask:l.notUndefined(w,"original_ask"),data:l.notUndefined(w,"data"),extra:null,questions:l.notUndefined(w,"questions"),detail:null,table:null})}if(i){let w=await l.Browser().storage.local.get("settings"),E=b.ai_model;l.notUndefined(w,"settings")&&(E=l.notUndefined(w,"settings.ai_model"));let A=typeof l.Browser().web_access_mode<"u"?l.Browser().web_access_mode:"ai_chat",j=typeof l.Browser().web_access_extra_key<"u"?l.Browser().web_access_extra_key:"__all";Q.chat(n,E,A,j,!0,!1,null,!0,{search:q,web_access:!0})}return new Promise((w,E)=>w(q))};cleanTextEmpty(e){return e&&e.replace(/[\r\n]+/gm," ").replace(/[\t]+/gm," ").replace(/[\s]+/gm," ").trim()}prepareContentForSearch(e){if(!e)return"";if(typeof e=="string")try{e=JSON.parse(e)}catch{return e.substring(0,2e3)}let t=[];if(e.meta&&(e.meta.title&&t.push(e.meta.title),e.meta.description&&t.push(e.meta.description)),e.importantTags&&["h1","h2","h3"].forEach(n=>{e.importantTags[n]&&t.push(e.importantTags[n].replace(/ OR /g," "))}),e.mainContent){const n=e.mainContent.split(/[.!?]+/).map(a=>a.trim()).filter(a=>a.length>20);n.length>0&&t.push(n.slice(0,3).join(" "))}return t.join(" ").replace(/\s+/g," ").replace(/[^\w\s-]/g,"").trim().substring(0,2e3)}parseMeaningfulContentFromHTML(e){var r,u,c,p,g,_,h;const i=new DOMParser().parseFromString(e,"text/html");["script","style","iframe","nav","header","footer","aside","noscript","link","body .ad","body .advertisement","body #ads","body #ad-container","body .social-share","body .comments","body .related-articles",'body [class*="ads"]','body [id*="ads"]','body [class*="banner"]'].forEach(m=>{i.querySelectorAll(m).forEach(T=>T.remove())});const a={importantTags:{},meta:{title:"",description:""},mainContent:null};a.meta.title=((u=(r=i.querySelector("title"))==null?void 0:r.textContent)==null?void 0:u.trim())||"",a.meta.description=((p=(c=i.querySelector('meta[name="description"]'))==null?void 0:c.getAttribute("content"))==null?void 0:p.trim())||"",["h1","h2","h3","h4","h5","h6"].forEach(m=>{const y=i.querySelectorAll(m);y.length>0&&(a.importantTags[m]=Array.from(y).map(T=>{var x;return(x=T==null?void 0:T.textContent)==null?void 0:x.trim()}).filter(T=>T).join(" OR "))});const s=["article","main",".content",".post-content",".article-content","#main-content",'[role="main"]'];for(const m of s){const y=i.querySelector(m);if(y){a.mainContent=((g=y==null?void 0:y.textContent)==null?void 0:g.trim().replace(/\s+/g," ").replace(/\n\s*/g,`
`).replace(/\s*\n\s*\n\s*/g,`

`))||null;break}}return a.mainContent||(a.mainContent=((h=(_=i==null?void 0:i.body)==null?void 0:_.textContent)==null?void 0:h.trim().replace(/\s+/g," ").replace(/\n\s*/g,`
`).replace(/\s*\n\s*\n\s*/g,`

`))||null),a}setSidebar(e="#aifnmjmchg-full-screen",t="aifnmjmchg-full"){if(!document)return;let i=document.createElement("div");i.id="aifnmjmchg-container";let n=document.createElement("div");n.id="aifnmjmchg",document.querySelector(e)!=null?(n.id=t,document.querySelector(e).classList.add("aifnmjmchg")):n.classList.add("aifnmjmchg"),n.append(i);let a=document.querySelector("body");if((a.getAttribute("id")??"").indexOf("aifnmjmchg")==-1){let r="html";a=document.querySelector(r)}a==null||a.append(n)}tabExtensionPage=(e=null)=>{if(l.notUndefined(e,"filters")){let t=!0;return l.Browser().tabs.query(l.notUndefined(e,"filters")).then(i=>{i.forEach(n=>{if(t=!1,l.notUndefined(e,"filter_url")?n.url.indexOf(l.notUndefined(e,"filter_url"))!==-1&&(t=!0):t=!0,console.log(t,l.notUndefined(e,"filter_url")),l.notUndefined(e,"url")&&t&&(e.active=!0,l.Browser().tabs.update(n.id,{url:e.url}).then()),t)return n})})}};removeEmptyLines(e){return e&&e.replace(/^\s*[\r\n]/gm,"").trim()}treeKeybyValueBuild(e,t,i,n=".",a=0,s={}){return typeof e!="object"&&(e=e.split(n)),typeof e[a]>"u"?t:(typeof i[e[a]]<"u"&&(s[e[a]]=i[e[a]]),s[e[a]]=this.treeKeybyValueBuild(e,t,i,n,a+1,s[e[a]]??{}),s)}Browser(){return d.Browser}addLoading(){if(d.runtime_id==null&&typeof document<"u"){let e="body > .aifnmjmchg";d.runtime_id==null&&(e="body.aifnmjmchg"),document&&document.querySelector(e)!=null&&document.querySelector(e+".aifnmjmchg-page-loading")==null&&document.querySelector(e).classList.add("aifnmjmchg-page-loading");return}}removeLoading(){let e=".aifnmjmchg-page-loading-container";if(d.runtime_id!=null&&(e="#aifnmjmchg-full-screen .aifnmjmchg-page-loading-container"),typeof document<"u"&&document&&document.querySelector(e)!=null&&(document.querySelectorAll(e).forEach(t=>t.classList.add("aifnmjmchg-loading-calm")),document.querySelectorAll(e).forEach(t=>t.remove()),setTimeout(()=>{document.querySelectorAll(e).forEach(t=>t.remove()),l.scrollToBottom()},5)),typeof document<"u"&&document){let t="body > .aifnmjmchg";d.runtime_id==null&&(t="body.aifnmjmchg"),setTimeout(()=>{document.querySelector(t+".aifnmjmchg-page-loading")!=null&&document.querySelector(t+".aifnmjmchg-page-loading").classList.remove("aifnmjmchg-page-loading"),l.scrollToBottom()},1)}}removeFirstLoading(){d.runtime_id==null&&typeof document<"u"&&document.querySelector(".aifnmjmchg-page-loading-container")!=null&&(document.querySelectorAll(".aifnmjmchg-page-loading-container").forEach(e=>e.classList.add("aifnmjmchg-loading-calm")),document.querySelectorAll(".aifnmjmchg-page-loading-container").forEach(e=>e.remove()),setTimeout(()=>{document.querySelectorAll(".aifnmjmchg-page-loading-container").forEach(e=>e.remove())},5))}async getIpDetail(){return{}}syncTimeout=null;_syncAppAndExtensionOrTabs=async(e=null)=>{typeof e=="object"&&e!==null&&Object.keys(e).length===0&&(e=null);let t=null;d.runtime_id==null&&(t=d.domain);let i=!0,n=!1;e!=null&&(typeof e.back<"u"&&(i=!1),typeof e.type<"u"&&(n=e.type),typeof e.setter_domain<"u"&&(t=e.setter_domain),typeof e.storage<"u"&&(e=e.storage));let a={storage:e,type:n,setter_domain:t};if(d.runtime_id!=null)return e!=null&&await l.GetSetSyncData(a),await l.TabMessageSync({target:null,function:async s=>(s.back=!1,await window.postMessage({fn:"SyncAppAndExtensionOrTabs",data:s})),args:[a]},t);if(e==null){if(!l.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;a.storage=await l.GetSetSyncData();let s=await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"GetSetSyncData",data:a});if(a.storage=l.notUndefined(s,"return_data"),a.type=!0,typeof a.storage=="object"&&a.storage!=null&&Object.keys(a.storage).length==0&&(a.storage=null),a.storage==null)return{}}else if(a.type=!1,i){if(!l.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"SyncAppAndExtensionOrTabs",data:a})}return await l.GetSetSyncData(a)};SyncAppAndExtensionOrTabs=async(e=null)=>(this.syncTimeout&&clearTimeout(this.syncTimeout),new Promise(t=>{this.syncTimeout=setTimeout(async()=>{let i=await this._syncAppAndExtensionOrTabs(e);t(i)},400)}));GetSetSyncData=async(e=null)=>{if(e!=null){let t=!1;l.notUndefined(e,"setter_domain")&&l.notUndefined(e,"setter_domain"),typeof e.type<"u"&&(t=e.type);let i=l.notUndefined(f.Local,"migration"),n=l.notUndefined(e,"storage.local.migration");return n==null&&(n=l.notUndefined(e,"storage.local.ai_chat_ids.ai_chat")),t==!1&&(i<n||i==null?t=!0:t=!1),t==!0&&l.notUndefined(e,"storage")?(Object.keys(e.storage).forEach(a=>{if(l.notUndefined(l.Browser().storage,a)){let s=a.toCapitalizeCase();i==null&&(e.storage.local.migration=n??new Date().getTime()),e.storage[a]&&(e.storage[a]=l.JsonParse(e.storage[a]),(typeof e.storage[a].settings>"u"||l.notUndefined(e.storage[a],"settings")!=null)&&(f.Local.migration_status=!0,e.storage[a].migration_status=!0,l.Browser().storage[a].set(e.storage[a]).then(()=>{f.Local.migration_status=!1,l.Browser().storage.local.set({migration_status:!1}),f[s]=Object.assign(f[s],e.storage[a])})))}}),{}):{local:l.JsonParse(f.Local),sync:l.JsonParse(f.Sync),runtime_id:d.runtime_id}}return{local:l.JsonParse(f.Local),sync:l.JsonParse(f.Sync),runtime_id:d.runtime_id}};TabMessageSync=async(e,t=null)=>{if(l.notUndefined(l.Browser().tabs,"query")&&d.domain_allows&&e){let i=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im,n=Object.values(d.domain_allows);t!=null&&n.indexOf(t)!==-1&&n.splice(n.indexOf(t),1),n.forEach(a=>{l.Browser().tabs.query({status:"complete"}).then(s=>{s.forEach(async r=>{if(r.url){let u=r.url.match(i)[1]??null;u!=null&&u.indexOf(d.web_app_prefix+a)!==-1&&(r.url.indexOf("https://"+d.web_app_prefix+a+"/")!==-1||r.url.indexOf("https://beta_"+d.web_app_prefix+a+"/")!==-1)&&(f.Local.migration_status=!0,e.target={tabId:r.id},await l.Browser().scripting.executeScript(e),f.Local.migration_status=!1,await l.Browser().storage.local.set({migration_status:!1}))}})})})}};setHistory=(e,t)=>l.apiCall("/extensions/app/set_history",{chat_id:e,history:t},"POST").then(async i=>{if(l.notUndefined(i,"all_histories")){let n=l.notUndefined(i,"all_histories");return n&&(n=l.getHistoryFixer(n)),l.Browser().storage.local.set({histories:n}),n}});getHistories=(e=!1)=>new Promise(t=>l.Browser().storage.local.get("histories").then(i=>typeof i.histories<"u"&&e==!1&&i.histories!=null&&Object.keys(i.histories).length>0?t(i.histories):l.apiCall("/extensions/app/get_history",null,"POST").then(async n=>{if(l.notUndefined(n,"all_histories")){let a=l.notUndefined(n,"all_histories");return a&&(a=l.getHistoryFixer(a)),l.Browser().storage.local.set({histories:a}),a}})));getActiveHistories=async(e={})=>{let t=await l.Browser().storage.local.get("ai_chat_ids")??{};return t.ai_chat_ids&&(t=t.ai_chat_ids),await l.apiCall("/extensions/app/get_active_history",{chat_ids:t},"POST").then(async i=>{if(l.notUndefined(i,"histories")){let n=l.notUndefined(i,"histories"),a=l.notUndefined(i,"history_ids");n&&(n=l.getHistoryFixer(n));let s=await l.Browser().storage.local.get("ai_single").ai_single??{};s=Object.assign(s,n.ai_single);let r={};return n.ai_chat&&Object.keys(n.ai_chat).length>0&&(r.ai_chat=n.ai_chat),s&&Object.keys(s).length>0&&(r.ai_single=s),a&&Object.keys(a).length>0&&(a=Object.assign(a,t),r.ai_chat_ids=a,f.Local.ai_chat_ids=a),Object.keys(r).length>0&&await l.Browser().storage.local.set(r),f.Local=Object.assign(f.Local,r),{histories:n,history_ids:a}}})};getHistoryFixer=e=>{let t=this.__("Hello, how can I help you today?");return Object.keys(e).forEach(i=>{l.notUndefined(e,i)&&(l.notUndefined(e[i],"0.role")?l.notUndefined(e[i],"0.role")=="user"&&(e[i]=[{item:t,role:"assistant",model:l.notUndefined(e[i],"0.model"),loading:!1},...Object.values(e[i])]):Object.keys(e[i]).forEach(n=>{l.notUndefined(e[i],n)&&l.notUndefined(e[i][n],"items")&&l.notUndefined(e[i][n].items,"0.role")=="user"&&(e[i][n].items=[{item:t,role:"assistant",model:l.notUndefined(e[i][n].items,"0.model"),loading:!1},...Object.values(e[i][n].items)])}))}),e};getSearchFilter=(e,t=null,i=!1)=>t?Object.values(e).filter(n=>{if(typeof n=="object")return Object.values(n).some(a=>typeof a=="object"&&i==!0?JSON.stringify(a).toString().toLowerCase().includes(t.toLowerCase()):a.toString().toLowerCase().includes(t.toLowerCase()));if(typeof n=="string")return n.toLowerCase().indexOf(t.toString().toLowerCase())!==-1}):e;getKeySearch=(e,t=null,i=!1,n=!1)=>{if(!t)return e;let a=null;return i==!0?a={}:a=[],Object.keys(e).some(s=>{s.toString().toLowerCase().includes(t.toLowerCase())&&(i==!0?n?a[s.replace(t,"")]=e[s]:a[s]=e[s]:a.push(s)),s.toString().toLowerCase().includes(t.toLowerCase())}),a};domainByUrls=e=>{l.Browser().storage.local.set({domain:e});let t=d.web_app_prefix+e,i={domain:e,site:`https://${t}`,site_buy_plan:`https://${t}/subscription`,site_payment:`https://${t}/payment`,site_pricing:`https://${t}/pricing`,login:`https://${t}/auth`,api_url:`https://${d.api_mode}.${e}`,download_url:`https://download.${e}`,cdn_url:`https://cdn.${e}`};return d.domain_allows&&d.domain_allows.indexOf(e)===-1&&d.domain_allows.push(e),Object.keys(i).forEach(n=>{d[n]=i[n]}),i};ObjectSorting=(e,t=!0,i=null)=>Object.fromEntries(Object.entries(e).sort(([,n],[,a])=>(i!==null&&(typeof n[i]<"u"&&(Number.isNaN(parseFloat(n[i]))||(n=n[i])),typeof a[i]<"u"&&(Number.isNaN(parseFloat(a[i]))||(a=a[i]))),t?parseFloat(n)-parseFloat(a):parseFloat(a)-parseFloat(n))));clearStorage=(e=!1)=>{e==!0&&(l.Browser().storage.local&&l.Browser().storage.local.clear(),l.Browser().storage.sync&&l.Browser().storage.sync.clear());let t=["app_details","check_extension_expire","check_extension","token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","start_scrap","language_var_sync","language_variables","languages","ai_models","ai_type_models","ai_prompts","selected_ask","selected_question","selected_write","prompt_settings","model_settings","files","faq","packages","developer","domain","draggable_modal_history","ai_chat_ids","ai_contextPrompts","delete_key","ai_single"];l.Browser().storage.local.get().then(n=>{l.Browser().storage.local.remove(l.getKeySearch(n,"ai_single_"))});let i={ai_single:[l.SHA1("image"),l.SHA1("chat_with_file")]};l.Browser().storage.local.get("delete_key").then(n=>{typeof n.delete_key=="object"&&Object.values(n.delete_key).forEach(a=>{i.ai_single.push(a)})}),l.Browser().storage.local.get("ai_prompts").then(n=>{let a={};if(typeof n.ai_prompts<"u"){try{a=JSON.parse(n.ai_prompts)}catch{a=n.ai_prompts}let s=[];Object.values(a).forEach(r=>{let u=r.mode;typeof u=="object"&&(u=u.join(",")),s.indexOf("selected_"+u)==-1&&s.push("selected_"+u)}),l.Browser().storage.local.remove(s).then()}}),l.Browser().storage.local.remove(t).then(),Object.keys(i).forEach(n=>{l.Browser().storage.local.get(n).then(a=>{if(typeof a[n]<"u"){let s=!1,r=!1;try{a[n]=JSON.parse(a[n]),r=!0}catch{}let u=i[n];a[n]!==null&&(typeof a[n]=="object"?Object.keys(a[n]).forEach(c=>{u.indexOf(c)===-1&&(s=!0,delete a[n][c])}):(s=!0,delete a[n])),r&&(a[n]=JSON.stringify(a[n])),s&&l.Browser().storage.local.set(a).then()}})}),l.Browser().storage.local.remove(["ai_setup"]).then(),l.Browser().storage.local.set({show_sidebar:!1}).then()};promptIdByGetValues=e=>{let t=f.Local.prompt_settings,i=f.Local.model_settings,n={};return t&&(Object.keys(t).forEach(a=>{if(a.indexOf(e)!==-1){let s=a.split("-_-"),r=s[0],u=t[a],c=l.notUndefined(i,`${r}`),p=l.notUndefined(c,`items.${u}`),g=l.notUndefined(p,"title");n[a]={name:c.title,id:s[0]??null,value:u,priority:s[1].split("_")[1]??0,title:g??r}}}),n=l.ObjectSorting(n,!0,"priority")),n};emptyResolve=()=>new Promise((e,t)=>{});onSettingTypeByValue(e,t){if(e&&typeof e.type<"u"){if(typeof e.mode<"u"&&e.mode=="attribute")return t.getAttribute(e.type);if(typeof t[e.type]<"u")return t[e.type]}}emailSuggestion=async(e,t,i)=>{let n=this.MD5(e);return l.Browser().storage.local.get("email_suggestions").then(async a=>l.notUndefined(a,"email_suggestions."+n)?l.notUndefined(a,"email_suggestions."+n):await this.apiCall("/ai/email_suggestion",{text:e,history:t,extra_data:i},"POST").then(s=>(a[n]=s,s)))};positionByScreenCalc(e,t=10){let i=Math.max(-1,Math.min(e.top,window.innerHeight-(e.top+e.height+t)));i<=0?i=-(e.height+t):i=e.height+t;let n=Math.max(-1,Math.min(e.top,window.innerWidth-(e.top+e.width+t)));return n<=0?n=-(e.width+t):n=e.width+t,{top:i,left:n}}async getYtSummarize(){let e="",t=null;if(typeof window<"u"&&window.location&&window.location.host.indexOf("youtube.")!==-1){t=window.ytInitialPlayerResponse??null,t===null&&document.querySelectorAll("body script").forEach(s=>{if(s){let r=s;if(r.innerText.indexOf("var ytInitialPlayerResponse")!==-1)try{t=JSON.parse(r.innerText.match("{.*:{.*:.*}}")[0])}catch{}}});let i=f.Local.settings.language;if(typeof(t==null?void 0:t.captions)>"u")return{};if(typeof(t==null?void 0:t.captions.playerCaptionsTracklistRenderer)>"u")return{};if(typeof(t==null?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks)>"u")return{};let n=t==null?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks,a=null;if(n&&(n.forEach(s=>{i===s.languageCode&&(a=l.notUndefined(s,"baseUrl"))}),a==null&&(a=l.notUndefined(n,"0.baseUrl"))),a!==null&&t){let s=await fetch(a).then(c=>c.text()),r={compact:!1,ignoreComment:!0,spaces:4};s=l.JsonParse(ue.xml2json(s,r))??s;let u=l.notUndefined(s,"elements.0.elements");return u&&u.forEach((c,p)=>{let g={text:"",start:l.notUndefined(c,"attributes.start"),dur:l.notUndefined(c,"attributes.dur")},_=l.notUndefined(c,"elements");_&&_.forEach((h,m)=>{m!==0?g.text+=" "+h.text:g.text+=h.text}),e+="second:"+parseFloat(g.start).toFixed(0)+" text:"+g.text+`
`}),{content:e,detail:t,url:a}}}}eventMarkedInText(){document.querySelector(".aifnmjmchg").addEventListener("mouseover",e=>{let i=e.target.closest("pre code");if(i!=null&&i.querySelector(".aifnmjmchg-code-toolbox")===null&&i.querySelector(".aifnmjmchg-pre-header")===null){let n=i.innerText,a=document.createElement("div");a.classList.add("aifnmjmchg-code-toolbox");let s=document.createElement("button");s.value=l.__("Copy"),s.classList.add("aifnmjmchg-code-copy"),s.setAttribute("data-content",n),s.textContent=s.value,a.append(s);let r=document.createElement("button");r.value=l.__("Download"),r.classList.add("aifnmjmchg-code-download"),r.setAttribute("data-content",n);let u=Object.values(i.classList).join(" ");r.setAttribute("data-type",u.replace(/hljs language-/g,"")),r.textContent=r.value,a.append(r),i.append(a)}}),document.querySelector(".aifnmjmchg").addEventListener("mouseout",e=>{e.target.closest("pre code")==null&&(document.querySelector(".aifnmjmchg-code-toolbox")!=null?document.querySelector(".aifnmjmchg-code-toolbox").remove():document.querySelector(".aifnmjmchg-pre-header")!=null?document.querySelector(".aifnmjmchg-pre-header").remove():(document.querySelector(".aifnmjmchg-code-copy")!=null&&document.querySelector(".aifnmjmchg-code-copy").remove(),document.querySelector(".aifnmjmchg-code-download")!=null&&document.querySelector(".aifnmjmchg-code-download").remove()))}),document.querySelector(".aifnmjmchg").addEventListener("click",e=>{var n,a;let t=e.target;(n=t.classList)!=null&&n.contains("aifnmjmchg-code-copy")&&l.copyClipboard(t.getAttribute("data-content")),(a=t.classList)!=null&&a.contains("aifnmjmchg-code-download")&&l.downloadContent(t.getAttribute("data-content"),"plain/text","aitopia_"+Date.now()+"."+t.getAttribute("data-type"));let i=t.getAttribute("href");if(i&&i.indexOf("#")!==-1&&t.closest(".aifnmjmchg .ai_result")){let s=t.innerText;t.closest(".aifnmjmchg .ai_result").querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(r=>{(r.textContent.includes(s)||r.textContent.includes(i.replace(/-/," ").replace("#","")))&&(r.scrollIntoView(),e.stopPropagation(),e.preventDefault())})}})}downloadContent(e,t,i){const n=document.createElement("a"),a=new Blob([e],{type:t}),s=URL.createObjectURL(a);n.setAttribute("href",s),n.setAttribute("download",i),n.click(),this.notify&&this.notify.success(i+" "+this.__("Downloaded."))}encodeHTML(e){return e.replace(/([\u00A0-\u9999<>&])(.|$)/g,function(t,i,n){return i!=="&"||n!=="#"?(/[\u00A0-\u9999<>&]/.test(n)&&(n="&#"+n.charCodeAt(0)+";"),"&#"+i.charCodeAt(0)+";"+n):t})}decodeHTML(e){return e.replace(/&#([0-9]+);/g,function(t,i){return String.fromCharCode(parseInt(i))})}groupChatListener(){}sortValueLength(e=[],t="DESC"){return e==null?e:e.sort((i,n)=>t=="ASC"?i.length-n.length:n.length-i.length)}sortObjectKeys(e){return Object.keys(e).sort().reduce(function(t,i){return t[i]=e[i],t},{})}RegexSpecialFixer(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}fancyTimeFormat(e){const t=~~(e/3600),i=~~(e%3600/60),n=~~e%60;let a="";return t>0&&(a+=""+t+":"+(i<10?"0":"")),a+=""+i+":"+(n<10?"0":""),a+=""+n,a}isNative(e){return/\{\s*\[native code\]\s*\}/.test(""+e)}async announcementModal(e){e&&typeof e.id<"u"&&l.Browser().storage.local.get("announcements").then(t=>{let i={};typeof t.announcements<"u"&&(i=t.announcements),(typeof i[e.id]>"u"||typeof e.force<"u")&&(i[e.id]=e),l.Browser().storage.local.set({announcements:i})})}extensionID(){return d.runtime_id!==null?d.runtime_id:d.manuel_extension_id}async checkExtension(e=!1){return d.manuel_extension_id==d.runtime_id?d.runtime_id:await l.Browser().storage.local.get(["check_extension_expire","check_extension"]).then(async t=>{let i=t.check_extension_expire??null,n=t.check_extension??d.runtime_id,a=parseInt(Date.now().toString().substring(0,10)),s=5,r={};if((i??0)>a&&!e)return n;n!=d.runtime_id&&await fetch("chrome-extension://"+n+"/aitopia/service-worker-loader.js").then(c=>c.text()).then(c=>{}).catch(async c=>{n=d.runtime_id,await l.Browser().storage.local.set({check_extension:n,check_extension_delete:!0})});let u=(Date.now()+s*6e4).toString().substring(0,10);r.check_extension_expire=parseInt(u),r.check_extension=n,await l.Browser().storage.local.set(r);try{let c=await fetch("chrome-extension://"+d.manuel_extension_id+"/service-worker-loader.js").then(p=>p.text()).then(p=>{r.check_extension=d.manuel_extension_id}).catch(p=>{})}catch{}return await l.Browser().storage.local.set(r),await l.Browser().storage.local.set({check_extension:r.check_extension}),console.log(r),r.check_extension})}hex2rgb(e){const t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return`${t}, ${i}, ${n}`}}Object.defineProperty(String.prototype,"toFirstUpperCase",{value:function(){return this?`${this.substring(0,1).toUpperCase()}${this.substring(1)}`:this}});Object.defineProperty(String.prototype,"toEscapeHTML",{value:function(){return this?this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):this}});Object.defineProperty(String.prototype,"toUnEscapeHTML",{value:function(){return this?this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):this}});Object.defineProperty(String.prototype,"toCapitalizeCase",{value:function(){if(!this)return this;let o=this.split(" ");return o.forEach((e,t)=>{o[t]=e.toFirstUpperCase()}),`${o.join(" ")}`}});Object.defineProperty(Object.prototype,"searchElement",{value:function(o){return this?(l.getSearchFilter(this,o)??[null])[0]??null:this}});Object.defineProperty(Object.prototype,"sortKey",{value:()=>l.sortObjectKeys(void 0)});Object.defineProperty(Array.prototype,"sortValueLength",{value:function(o="DESC"){return l.sortValueLength(this,o)}});const l=new _e;export{Q as A,V as E,l as H,f as S,b as a,d as c};
