import{r as j}from"./7afa0b1c12b13d1626d2f2c8e2aa1ee0.js";import{o as B}from"./64c9ab4069ddfd9b3fd37861f0dfe0bc.js";var k={},z={},M={exports:{}},T=M.exports=function(r,u){this._tokens=r,this._startIndex=u||0};T.prototype.head=function(){return this._tokens[this._startIndex]};T.prototype.tail=function(r){return new T(this._tokens,this._startIndex+1)};T.prototype.toArray=function(){return this._tokens.slice(this._startIndex)};T.prototype.end=function(){return this._tokens[this._tokens.length-1]};T.prototype.to=function(r){var u=this.head().source,a=r.head()||r.end();return u.to(a.source)};var G=M.exports,H=G;z.Parser=function(r){var u=function(a,s){return a(new H(s))};return{parseTokens:u}};var O={},R={failure:function(r,u){if(r.length<1)throw new Error("Failure must have errors");return new y({status:"failure",remaining:u,errors:r})},error:function(r,u){if(r.length<1)throw new Error("Failure must have errors");return new y({status:"error",remaining:u,errors:r})},success:function(r,u,a){return new y({status:"success",value:r,source:a,remaining:u,errors:[]})},cut:function(r){return new y({status:"cut",remaining:r,errors:[]})}},y=function(r){this._value=r.value,this._status=r.status,this._hasValue=r.value!==void 0,this._remaining=r.remaining,this._source=r.source,this._errors=r.errors};y.prototype.map=function(r){return this._hasValue?new y({value:r(this._value,this._source),status:this._status,remaining:this._remaining,source:this._source,errors:this._errors}):this};y.prototype.changeRemaining=function(r){return new y({value:this._value,status:this._status,remaining:r,source:this._source,errors:this._errors})};y.prototype.isSuccess=function(){return this._status==="success"||this._status==="cut"};y.prototype.isFailure=function(){return this._status==="failure"};y.prototype.isError=function(){return this._status==="error"};y.prototype.isCut=function(){return this._status==="cut"};y.prototype.value=function(){return this._value};y.prototype.remaining=function(){return this._remaining};y.prototype.source=function(){return this._source};y.prototype.errors=function(){return this._errors};var q={};q.error=function(r){return new C(r)};var C=function(r){this.expected=r.expected,this.actual=r.actual,this._location=r.location};C.prototype.describe=function(){var r=this._location?this._location.describe()+`:
`:"";return r+"Expected "+this.expected+`
but got `+this.actual};C.prototype.lineNumber=function(){return this._location.lineNumber()};C.prototype.characterNumber=function(){return this._location.characterNumber()};var V={};V.fromArray=function(r){var u=0,a=function(){return u<r.length};return new S({hasNext:a,next:function(){if(a())return r[u++];throw new Error("No more elements")}})};var S=function(r){this._iterator=r};S.prototype.map=function(r){var u=this._iterator;return new S({hasNext:function(){return u.hasNext()},next:function(){return r(u.next())}})};S.prototype.filter=function(r){var u=this._iterator,a=!1,s=!1,f,o=function(){if(!a)for(a=!0,s=!1;u.hasNext()&&!s;)f=u.next(),s=r(f)};return new S({hasNext:function(){return o(),s},next:function(){o();var l=f;return a=!1,l}})};S.prototype.first=function(){var r=this._iterator;return this._iterator.hasNext()?r.next():null};S.prototype.toArray=function(){for(var r=[];this._iterator.hasNext();)r.push(this._iterator.next());return r};(function(r){var u=j,a=B,s=R,f=q,o=V;r.token=function(e,t){var i=t!==void 0;return function(n){var v=n.head();if(v&&v.name===e&&(!i||v.value===t))return s.success(v.value,n.tail(),v.source);var h=N({name:e,value:t});return c(n,h)}},r.tokenOfType=function(e){return r.token(e)},r.firstOf=function(e,t){return u.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),function(i){return o.fromArray(t).map(function(n){return n(i)}).filter(function(n){return n.isSuccess()||n.isError()}).first()||c(i,e)}},r.then=function(e,t){return function(i){var n=e(i);return n.map||console.log(n),n.map(t)}},r.sequence=function(){var e=Array.prototype.slice.call(arguments,0),t=function(n){var v=u.foldl(e,function(w,p){var g=w.result,b=w.hasCut;if(!g.isSuccess())return{result:g,hasCut:b};var x=p(g.remaining());if(x.isCut())return{result:g,hasCut:!0};if(x.isSuccess()){var A;p.isCaptured?A=g.value().withValue(p,x.value()):A=g.value();var $=x.remaining(),D=n.to($);return{result:s.success(A,$,D),hasCut:b}}else return b?{result:s.error(x.errors(),x.remaining()),hasCut:b}:{result:x,hasCut:b}},{result:s.success(new l,n),hasCut:!1}).result,h=n.to(v.remaining());return v.map(function(w){return w.withValue(r.sequence.source,h)})};t.head=function(){var n=u.find(e,i);return r.then(t,r.sequence.extract(n))},t.map=function(n){return r.then(t,function(v){return n.apply(this,v.toArray())})};function i(n){return n.isCaptured}return t};var l=function(e,t){this._values=e||{},this._valuesArray=t||[]};l.prototype.withValue=function(e,t){if(e.captureName&&e.captureName in this._values)throw new Error('Cannot add second value for capture "'+e.captureName+'"');var i=u.clone(this._values);i[e.captureName]=t;var n=this._valuesArray.concat([t]);return new l(i,n)},l.prototype.get=function(e){if(e.captureName in this._values)return this._values[e.captureName];throw new Error('No value for capture "'+e.captureName+'"')},l.prototype.toArray=function(){return this._valuesArray},r.sequence.capture=function(e,t){var i=function(){return e.apply(this,arguments)};return i.captureName=t,i.isCaptured=!0,i},r.sequence.extract=function(e){return function(t){return t.get(e)}},r.sequence.applyValues=function(e){var t=Array.prototype.slice.call(arguments,1);return function(i){var n=t.map(function(v){return i.get(v)});return e.apply(this,n)}},r.sequence.source={captureName:"☃source☃"},r.sequence.cut=function(){return function(e){return s.cut(e)}},r.optional=function(e){return function(t){var i=e(t);return i.isSuccess()?i.map(a.some):i.isFailure()?s.success(a.none,t):i}},r.zeroOrMoreWithSeparator=function(e,t){return _(e,t,!1)},r.oneOrMoreWithSeparator=function(e,t){return _(e,t,!0)};var m=r.zeroOrMore=function(e){return function(t){for(var i=[],n;(n=e(t))&&n.isSuccess();)t=n.remaining(),i.push(n.value());return n.isError()?n:s.success(i,t)}};r.oneOrMore=function(e){return r.oneOrMoreWithSeparator(e,d)};function d(e){return s.success(null,e)}var _=function(e,t,i){return function(n){var v=e(n);if(v.isSuccess()){var h=r.sequence.capture(e,"main"),w=m(r.then(r.sequence(t,h),r.sequence.extract(h))),p=w(v.remaining());return s.success([v.value()].concat(p.value()),p.remaining())}else return i||v.isError()?v:s.success([],n)}};r.leftAssociative=function(e,t,i){var n;i?n=[{func:i,rule:t}]:n=t,n=n.map(function(h){return r.then(h.rule,function(w){return function(p,g){return h.func(p,w,g)}})});var v=r.firstOf.apply(null,["rules"].concat(n));return function(h){var w=h,p=e(h);if(!p.isSuccess())return p;for(var g=v(p.remaining());g.isSuccess();){var b=g.remaining(),x=w.to(g.remaining()),A=g.value();p=s.success(A(p.value(),x),b,x),g=v(p.remaining())}return g.isError()?g:p}},r.leftAssociative.firstOf=function(){return Array.prototype.slice.call(arguments,0)},r.nonConsuming=function(e){return function(t){return e(t).changeRemaining(t)}};var N=function(e){return e.value?e.name+' "'+e.value+'"':e.name};function c(e,t){var i,n=e.head();return n?i=f.error({expected:t,actual:N(n),location:n.source}):i=f.error({expected:t,actual:"end of tokens"}),s.failure([i],e)}})(O);var F={exports:{}};F.exports=function(r,u){var a={asString:function(){return r},range:function(s,f){return new I(r,u,s,f)}};return a};var I=function(r,u,a,s){this._string=r,this._description=u,this._startIndex=a,this._endIndex=s};I.prototype.to=function(r){return new I(this._string,this._description,this._startIndex,r._endIndex)};I.prototype.describe=function(){var r=this._position(),u=this._description?this._description+`
`:"";return u+"Line number: "+r.lineNumber+`
Character number: `+r.characterNumber};I.prototype.lineNumber=function(){return this._position().lineNumber};I.prototype.characterNumber=function(){return this._position().characterNumber};I.prototype._position=function(){for(var r=this,u=0,a=function(){return r._string.indexOf(`
`,u)},s=1;a()!==-1&&a()<this._startIndex;)u=a()+1,s+=1;var f=this._startIndex-u+1;return{lineNumber:s,characterNumber:f}};var W=F.exports,L=function(r,u,a){this.name=r,this.value=u,a&&(this.source=a)},P={};(function(r){var u=O,a=R;r.parser=function(o,l,m){var d={rule:e,leftAssociative:t,rightAssociative:i},_=new s(m.map(c)),N=u.firstOf(o,l);function c(h){return{name:h.name,rule:f(h.ruleBuilder.bind(null,d))}}function e(){return n(_)}function t(h){return n(_.untilExclusive(h))}function i(h){return n(_.untilInclusive(h))}function n(h){return v.bind(null,h)}function v(h,w){var p=N(w);return p.isSuccess()?h.apply(p):p}return d};function s(o){function l(c){return new s(o.slice(0,d().indexOf(c)))}function m(c){return new s(o.slice(0,d().indexOf(c)+1))}function d(){return o.map(function(c){return c.name})}function _(c){for(var e,t;;)if(e=N(c.remaining()),e.isSuccess())t=c.source().to(e.source()),c=a.success(e.value()(c.value(),t),e.remaining(),t);else return e.isFailure()?c:e}function N(c){return u.firstOf("infix",o.map(function(e){return e.rule}))(c)}return{apply:_,untilExclusive:l,untilInclusive:m}}r.infix=function(o,l){function m(d){return r.infix(o,function(_){var N=l(_);return function(c){var e=N(c);return e.map(function(t){return function(i,n){return d(i,t,n)}})}})}return{name:o,ruleBuilder:l,map:m}};var f=function(o){var l;return function(m){return l||(l=o()),l(m)}}})(P);var U={},E=L,J=W;U.RegexTokeniser=K;function K(r){r=r.map(function(f){return{name:f.name,regex:new RegExp(f.regex.source,"g")}});function u(f,o){for(var l=new J(f,o),m=0,d=[];m<f.length;){var _=a(f,m,l);m=_.endIndex,d.push(_.token)}return d.push(s(f,l)),d}function a(f,o,l){for(var m=0;m<r.length;m++){var d=r[m].regex;d.lastIndex=o;var _=d.exec(f);if(_){var c=o+_[0].length;if(_.index===o&&c>o){var N=_[1],e=new E(r[m].name,N,l.range(o,c));return{token:e,endIndex:c}}}}var c=o+1,e=new E("unrecognisedCharacter",f.substring(o,c),l.range(o,c));return{token:e,endIndex:c}}function s(f,o){return new E("end",null,o.range(f.length,f.length))}return{tokenise:u}}k.Parser=z.Parser;k.rules=O;k.errors=q;k.results=R;k.StringSource=W;k.Token=L;k.bottomUp=P;k.RegexTokeniser=U.RegexTokeniser;k.rule=function(r){var u;return function(a){return u||(u=r()),u(a)}};export{k as l};
